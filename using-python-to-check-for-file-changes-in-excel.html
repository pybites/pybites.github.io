<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="Finding differences in excel files using Pandas! Index The Problem The Solution Future Enhancement Conclusion The Problem Data exchange in healthcare is ... harder than it needs to be. Not all...">
        <meta name="keywords" content="excel, os, pandas">
        <link rel="icon" href="https://pybit.es/favicon.ico">

        <title>Using Python to Check for File Changes in Excel - PyBites</title>

        <!-- Stylesheets -->
        <link href="https://pybit.es/theme/css/all.min.css" rel="stylesheet">
        <!-- /Stylesheets -->

        <!-- RSS Feeds -->
        <link href="https://pybit.es/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="PyBites Full Atom Feed" />
        <link href="https://pybit.es/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="PyBites Full RSS Feed" />
        <link href="https://pybit.es/feeds/tools.rss.xml" type="application/rss+xml" rel="alternate" title="PyBites Categories RSS Feed" />
        <!-- /RSS Feeds -->

        <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
          <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
          <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->

          <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5859c6a67eb6254d" async="async"></script>

        <!-- Google Analytics -->
        <script>
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

          ga('create', 'UA-89294245-1', 'auto');
          ga('send', 'pageview');
        </script>
        <!-- /Google Analytics -->



    <!-- mailchimp subscribe -->
    <script type="text/javascript" src="//downloads.mailchimp.com/js/signup-forms/popup/unique-methods/embed.js" data-dojo-config="usePlainJson: true, isDebug: false"></script><script type="text/javascript">window.dojoRequire(["mojo/signup-forms/Loader"], function(L) { L.start({"baseUrl":"mc.us14.list-manage.com","uuid":"822043293f280259d4b8d2a3e","lid":"ac7e2eb9ef","uniqueMethods":true}) })</script>
    <!-- end mailchimp subscribe -->

    <!-- Facebook Pixel Code -->
    <script>
      !function(f,b,e,v,n,t,s)
      {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
      n.callMethod.apply(n,arguments):n.queue.push(arguments)};
      if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
      n.queue=[];t=b.createElement(e);t.async=!0;
      t.src=v;s=b.getElementsByTagName(e)[0];
      s.parentNode.insertBefore(t,s)}(window, document,'script',
      'https://connect.facebook.net/en_US/fbevents.js');
      fbq('init', '204929054292880');
      fbq('track', 'PageView');
    </script>
    <noscript><img height="1" width="1" style="display:none"
      src="https://www.facebook.com/tr?id=204929054292880&ev=PageView&noscript=1"
    /></noscript>
    <!-- End Facebook Pixel Code -->

    </head>

    <body>

        <!-- Header -->
    <div class="header-container gradient">

            <!-- Static navbar -->
            <div class="container">
                <div class="header-nav">
                    <div class="header-logo">
                        <a class="pull-left" href="https://pybit.es/"><img class="mr20" src="https://pybit.es/images/logo.png" alt="logo"></a>
                    </div>
                    <div class="nav pull-right">
                                <a  href="https://pybit.es/">Home</a>
                                <a  href="https://pybit.es/archives.html">Blog</a>
                                <a href="https://codechalleng.es" target="_blank">Platform</a>
                                <a href="http://pybites.mykajabi.com" target="_blank">Members</a>
                                <a  style="background-color: #ba9926!important; border-radius: 5px;" href="https://pybit.es/pages/apply.html">Apply</a>
                    </div>
                </div>
            </div>
            <!-- /Static navbar -->

            <!-- Header -->
    <!-- Header -->
    <div class="container header-wrapper">
        <div class="row">
              <div class="col-lg-12">
                  <div class="header-content">
                      <h1 class="header-title">Using Python to Check for File Changes in Excel</h1>
                      <p class="header-date"> <a href="https://pybit.es/author/ryan-cheley.html">Ryan Cheley</a>, Fri 10 April 2020,  <a href="https://pybit.es/category/tools.html">Tools</a></p>
                      <div class="header-underline"></div>
                      <div class="clearfix"></div>
                      <p class="pull-right header-tags">
                          <span class="glyphicon glyphicon-tags mr5" aria-hidden="true"></span>
<a href="https://pybit.es/tag/excel.html">excel</a>, <a href="https://pybit.es/tag/os.html">os</a>, <a href="https://pybit.es/tag/pandas.html">pandas</a>                      </p>
                  </div>
              </div>
        </div>
    </div>
    <!-- /Header -->
            <!-- /Header -->

        </div>
        <!-- /Header -->


        <!-- Content -->
    <div class="container content">
        <p>Finding differences in excel files using Pandas!</p>
<!-- Indexes are always a good start! -->

<h2>Index</h2>
<ul>
<li><a href="#problem">The Problem</a></li>
<li><a href="#solution">The Solution</a></li>
<li><a href="#future">Future Enhancement</a></li>
<li><a href="#conclusion">Conclusion</a></li>
</ul>
<p><a name="problem"></a></p>
<h2>The Problem</h2>
<p>Data exchange in healthcare is ... harder than it needs to be. Not all partners in the healthcare arena understand and use technology to its fullest benefit. </p>
<p>Take for example several health plans which want data reported to them for CMS (Centers for Medicare and Medicaid Services) regulations. They will ask their 'delegated' groups to fill out an excel file. As in, they expect you will <em>actually</em> fill out an excel file, either by manually entering the data OR by potentially copying and pasting your data into their excel file. </p>
<p>They will also, quite frequently, change their mind on what they want AND the order in which they want the data to appear in their excel file. But there's no change log to tell you what (if anything has changed). All that you will get is an email which states, "Here's the new template to be used for report XYZ" ... even if this 'new' report is the same as the last one that was sent. </p>
<p>Some solutions might be to use versioning software (like Git) but all they will do is tell you that there is a difference, not <em>what</em> the difference is. For example, when looking at a simple excel file added to git and using <code>git diff</code> you see:</p>
<div class="highlight"><pre><span></span><span class="gh">diff --git a/Book3.xlsx b/Book3.xlsx</span>
<span class="gh">index 05a8b41..e96cdb5 100644</span>
Binary files a/Book3.xlsx and b/Book3.xlsx differ
</pre></div>


<p>This has been a giant pain in the butt for a while, but with the recent shelter-in-place directives, I have a bit more time on the weekends to solve these kinds of problems. </p>
<p><a name="solution"></a></p>
<h2>The Solution</h2>
<p>Python of Course! </p>
<p>Only two libraries are needed to make the comparison: (1) os, (2) pandas</p>
<p>The basic idea is to:</p>
<ol>
<li>Load the files</li>
<li>use pandas to compare the files</li>
<li>write out the differences, if they exist</li>
</ol>
<h3>Load the Files</h3>
<p>The code below loads the necessary libraries, and then loads the excel files into 2 pandas dataframes. One thing that my team has to watch out for are tab names that have leading spaces that aren't easy to see inside of excel. This can cause all sorts of nightmares from a troubleshooting perspective.</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>

<span class="n">file_original</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>\\<span class="n">path</span>\\<span class="n">to</span>\\<span class="n">original</span>\\<span class="nb">file</span><span class="p">,</span> <span class="n">original_file</span><span class="o">.</span><span class="n">xlsx</span><span class="p">)</span>
<span class="n">file_new</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>\\<span class="n">path</span>\\<span class="n">to</span>\\<span class="n">new</span>\\<span class="nb">file</span><span class="p">,</span> <span class="n">new_file</span><span class="o">.</span><span class="n">xlsx</span><span class="p">)</span>

<span class="n">sheet_name_original</span> <span class="o">=</span> <span class="n">name_of_sheet_in_original_file</span>
<span class="n">sheet_name_new</span> <span class="o">=</span> <span class="n">name_of_sheet_in_new_file</span>

<span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">file_original</span><span class="p">,</span> <span class="n">sheet_name_original</span><span class="p">)</span>
<span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">file_new</span><span class="p">,</span> <span class="n">sheet_name_new</span><span class="p">)</span>
</pre></div>


<h3>Use Pandas to compare</h3>
<p>This is just a one liner, but is super powerful. Pandas DataFrames have a method to see if two frames are the same. So easy!</p>
<div class="highlight"><pre><span></span><span class="n">data_frame_same</span> <span class="o">=</span> <span class="n">df1</span><span class="p">.</span><span class="k">equals</span><span class="p">(</span><span class="n">df2</span><span class="p">)</span>
</pre></div>


<h3>Write out the differences if they exist:</h3>
<p>First we specify where we're going to write out the differences to. We use <code>w+</code> because we'll be writing out to a file AND potentially appending, depending on differences that are found. The <code>f.truncate(0)</code> will clear out the file so that we get just the differences on this run. If we don't do this then we'll just append to the file over and over again ... and that can get confusing.</p>
<div class="highlight"><pre><span></span><span class="n">f</span><span class="p">.</span><span class="k">open</span><span class="p">(</span><span class="err">\\</span><span class="n">path</span><span class="err">\\</span><span class="k">to</span><span class="err">\\</span><span class="n">file</span><span class="err">\\</span><span class="k">to</span><span class="err">\\</span><span class="k">write</span><span class="err">\\</span><span class="n">differences</span><span class="p">.</span><span class="n">txt</span><span class="p">,</span> <span class="s1">&#39;w+&#39;</span><span class="p">)</span>
<span class="n">f</span><span class="p">.</span><span class="k">truncate</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>


<p>Next, we check to see if there are any differences and if they are, we write a simple message to our text file from above:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="nv">data_frame_same</span>:
    <span class="nv">f</span>.<span class="nv">write</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">No differences detected</span><span class="s1">&#39;</span><span class="ss">)</span>
</pre></div>


<p>If differences are found, then we loop through the lines of the file, finding the differences and and writing them to our file:</p>
<div class="highlight"><pre><span></span><span class="k">else</span>:
    <span class="nv">f</span>.<span class="nv">write</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">*** WARNING *** Differences Found</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="ss">)</span>
    <span class="k">for</span> <span class="nv">c</span> <span class="nv">in</span> <span class="nv">range</span><span class="ss">(</span><span class="nv">max</span><span class="ss">(</span><span class="nv">len</span><span class="ss">(</span><span class="nv">df1</span>.<span class="nv">columns</span><span class="ss">)</span>, <span class="nv">len</span><span class="ss">(</span><span class="nv">df2</span>.<span class="nv">columns</span><span class="ss">)))</span>:
        <span class="nv">try</span>:
            <span class="nv">header1</span> <span class="o">=</span> <span class="nv">df1</span>.<span class="nv">columns</span>[<span class="nv">c</span>].<span class="nv">strip</span><span class="ss">()</span>.<span class="nv">lower</span><span class="ss">()</span>.<span class="nv">replace</span><span class="ss">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>, <span class="s1">&#39;&#39;</span><span class="ss">)</span>
            <span class="nv">header2</span> <span class="o">=</span> <span class="nv">df2</span>.<span class="nv">columns</span>[<span class="nv">c</span>].<span class="nv">strip</span><span class="ss">()</span>.<span class="nv">lower</span><span class="ss">()</span>.<span class="nv">replace</span><span class="ss">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>, <span class="s1">&#39;&#39;</span><span class="ss">)</span>
            <span class="k">if</span> <span class="nv">header1</span> <span class="o">==</span> <span class="nv">header2</span>:
                <span class="nv">f</span>.<span class="nv">write</span><span class="ss">(</span><span class="nv">f</span><span class="s1">&#39;</span><span class="s">Headers are the same: {header1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="ss">)</span>
            <span class="k">else</span>:
                <span class="nv">f</span>.<span class="nv">write</span><span class="ss">(</span><span class="nv">f</span><span class="s1">&#39;</span><span class="s">Difference Found: {header1} -&gt; {header2}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="ss">)</span>
        <span class="nv">except</span>:
            <span class="nv">pass</span>

<span class="nv">f</span>.<span class="nv">close</span><span class="ss">()</span>
</pre></div>


<p>The code above finds the largest column header list (the file may have had a new column added) and uses a <code>try/except</code> to let us get the max of that to loop over. </p>
<p>Next, we check for differences between <code>header1</code> and <code>header2</code>. If they are the same, we just write that out, if they aren't, we indicate that <code>header1</code> was transformed to <code>header2</code></p>
<p>A sample of the output when the column headers have changed is below:</p>
<div class="highlight"><pre><span></span><span class="o">***</span> <span class="n">WARNING</span> <span class="o">***</span> <span class="n">Differences</span> <span class="k">Found</span>

<span class="n">Headers</span> <span class="k">are</span> <span class="n">the</span> <span class="n">same</span><span class="p">:</span> <span class="n">beneficiary</span> <span class="k">first</span> <span class="n">name</span>
<span class="p">...</span>
<span class="n">Difference</span> <span class="k">Found</span><span class="p">:</span> <span class="n">person</span> <span class="n">who</span> <span class="n">made</span> <span class="n">the</span> <span class="n">request</span> <span class="o">-&gt;</span> <span class="n">who</span> <span class="n">made</span> <span class="n">the</span> <span class="n">request</span><span class="o">?</span>
<span class="p">...</span>
</pre></div>


<p><a name="future"></a></p>
<h2>Future Enhancements</h2>
<p>In just using it a couple of times I've already spotted a couple of spots for enhancements:</p>
<ol>
<li>Use <code>input</code> to allow the user to enter the names/locations of the files</li>
<li>Read the tab names and allow user to select from command line</li>
</ol>
<p><a name="conclusion"></a></p>
<h2>Conclusion</h2>
<p>I'm looking forward to implementing the enhancements mentioned above to make this even more user friendly. In the mean time, it'll get the job done and allow someone on my team to work on something more interesting than comparing excel files to try (and hopefully find) differences.</p>
<p>-- <a href="pages/guests.html#ryancheley">Ryan</a></p>


    <div class="comments">
        <div id="disqus_thread"></div>
            <script type="text/javascript">
                var disqus_shortname = 'http-pybit-es';
                var disqus_identifier = 'using-python-to-check-for-file-changes-in-excel.html';
                var disqus_url = 'https://pybit.es/using-python-to-check-for-file-changes-in-excel.html';
                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
            </script>
        <noscript>Please enable JavaScript to view the comments.</noscript>
    </div>
        
    </div>
        <!-- /Content --> 

        <!-- Footer -->
        <div class="footer gradient-2">
            <div class="container footer-container ">
                <div class="row">
                    <div class="col-xs-4 col-sm-3 col-md-3 col-lg-3">
                        <div class="footer-title">Sitemap</div>
                        <ul class="list-unstyled">
                            <li><a href="https://pybit.es/pages/guests.html">Authors</a></li>
                            <li><a href="https://pybit.es/pages/community.html">Community</a></li>
                            <li><a href="https://pybit.es/pages/100days.html">100 Days Of Code</a></li>
                            <li><a href="https://pybit.es/pages/search.html">Search</a></li>
                            <li><a href="https://pybit.es/pages/privacy-policy.html">Privacy Policy</a></li>
                            <li><a href="https://pybit.es/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">Atom Feed</a></li>
                            <li><a href="https://pybit.es/feeds/all.rss.xml" type="application/rss+xml" rel="alternate">RSS Feed</a></li>
                        </ul>
                    </div>
                    <div class="col-xs-4 col-sm-3 col-md-3 col-lg-3">
                    </div>
                    <div class="col-xs-4 col-sm-3 col-md-3 col-lg-3">
                        <div class="footer-title">Reach Out</div>
                        <ul class="list-unstyled">
                            <li><a href="mailto:info@pybit.es" target="_blank">Email</a></li>
                            <li><a href="https://twitter.com/pybites" target="_blank">Twitter</a></li>
                            <li><a href="https://facebook.com/pybites" target="_blank">Facebook</a></li>
                            <li><a href="https://github.com/pybites" target="_blank">Github</a></li>
                            <li><a href="https://github.com/PyBites-Open-Source" target="_blank">Open Source</a></li>
                            <li><a href="https://www.youtube.com/channel/UCBn-uKDGsRBfcB0lQeOB_gA" target="_blank">YouTube</a></li>
                        </ul>
                    </div> 
                    <div class="col-xs-12 col-sm-3 col-md-3 col-lg-3">
                        <p class="pull-right text-right">
                            <small><em>Proudly powered by <a href="http://docs.getpelican.com/" target="_blank">pelican</a></em></small><br/>
                            <small><em>Theme and code by <a href="https://github.com/molivier" target="_blank">molivier</a></em></small><br/>
                            <small>&copy; PyBites 2016+</small>
                        </p>
                    </div>
                </div>
            </div>
        </div>
        <!-- /Footer -->
    </body>
</html>