<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="This week I discovered the Pexpect module. Where have you been all my life?! What is Pexpect? Pexpect is a cool automation module. Its main function is to automate interactive processes that...">
        <meta name="keywords" content="automation, code, pexpect, pybites, python, tips">
        <link rel="icon" href="./favicon.ico">

        <title>PyBites Module of the Week - Pexpect - PyBites</title>

        <!-- Stylesheets -->
        <link href="./theme/css/all.min.css" rel="stylesheet">
        <!-- /Stylesheets -->

        <!-- RSS Feeds -->
        <link href="https://pybit.es/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="PyBites Full Atom Feed" />
        <link href="https://pybit.es/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="PyBites Full RSS Feed" />
        <link href="https://pybit.es/feeds/modules.rss.xml" type="application/rss+xml" rel="alternate" title="PyBites Categories RSS Feed" />
        <!-- /RSS Feeds -->

        <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
          <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
          <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->

          <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5859c6a67eb6254d" async="async"></script>

        <!-- Google Analytics -->
        <script>
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

          ga('create', 'UA-89294245-1', 'auto');
          ga('send', 'pageview');
        </script>
        <!-- /Google Analytics -->


    </head>

    <body>

        <!-- Header -->
    <div class="header-container gradient">

            <!-- Static navbar -->
            <div class="container">
                <div class="header-nav">
                    <div class="header-logo">
                        <a class="pull-left" href="./"><img class="mr20" src="./images/logo.png" alt="logo"></a>
                    </div>
                    <div class="nav pull-right">
                                <a  href="./">Home</a>
                                <a  href="./archives.html">Blog</a>
                                <a href="https://codechalleng.es" target="_blank">Platform</a>
                                <a  style="background-color: #ba9926!important; border-radius: 5px;" href="./pages/apply.html">Apply</a>
                    </div>
                </div>
            </div>
            <!-- /Static navbar -->

            <!-- Header -->
    <!-- Header -->
    <div class="container header-wrapper">
        <div class="row">
              <div class="col-lg-12">
                  <div class="header-content">
                      <h1 class="header-title">PyBites Module of the Week - Pexpect</h1>
                      <p class="header-date"> <a href="./author/julian.html">Julian</a>, Thu 27 July 2017,  <a href="./category/modules.html">Modules</a></p>
                      <div class="header-underline"></div>
                      <div class="clearfix"></div>
                      <p class="pull-right header-tags">
                          <span class="glyphicon glyphicon-tags mr5" aria-hidden="true"></span>
<a href="./tag/automation.html">automation</a>, <a href="./tag/code.html">code</a>, <a href="./tag/pexpect.html">pexpect</a>, <a href="./tag/pybites.html">pybites</a>, <a href="./tag/python.html">python</a>, <a href="./tag/tips.html">tips</a>                      </p>
                  </div>
              </div>
        </div>
    </div>
    <!-- /Header -->
            <!-- /Header -->

        </div>
        <!-- /Header -->


        <!-- Content -->
    <div class="container content">
        <p>This week I discovered the <a href="https://pexpect.readthedocs.io/en/stable/index.html">Pexpect</a> module. Where have you been all my life?!</p>
<p><br></p>
<h2>What is Pexpect?</h2>
<p>Pexpect is a cool automation module. Its main function is to automate interactive processes that provide predictable output. Think apps like telnet, ssh, git and so forth.
We automate these by telling pexpect what to expect from the application and then what to send back.</p>
<p>Pexpect essentially takes your place as a human and starts interacting with the application on your behalf!</p>
<p>The easiest way to explain this is to show you.</p>
<p><br></p>
<h2>Key Functionality</h2>
<p>There are two main uses for Pexpect that I’ll touch on in this article: <code>spawn</code> and <code>run</code>.</p>
<h3>The Spawn Class</h3>
<p><code>pexpect.spawn()</code> is used to start your application off. The parameter you pass to it is the command you as a human overlord would type into your OS CLI. Eg:</p>
<div class="highlight"><pre><span></span><span class="n">child</span> <span class="o">=</span> <span class="n">pexpect</span><span class="p">.</span><span class="n">spawn</span><span class="p">(</span><span class="err">‘</span><span class="n">ssh</span> <span class="n">user</span><span class="mf">@192.168.1.1</span><span class="err">’</span><span class="p">)</span>
</pre></div>


<p>Using this example, pexpect will kick off an ssh connection the host. We then have to tell pexpect what to <em>expect</em> back.</p>
<div class="highlight"><pre><span></span><span class="n">pexpect</span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="err">‘</span><span class="n">user</span><span class="mf">@10.1.1.10</span><span class="err">\’</span><span class="n">s</span> <span class="nl">password</span><span class="p">:</span><span class="err">’</span><span class="p">)</span>
</pre></div>


<p>You can see that I’m literally telling pexpect what <em>it</em> should see when it initiates the first ssh command. I want pexpect to log into this box for me so I’ll need it to pass on my password (never hardcode your password into a script!):</p>
<div class="highlight"><pre><span></span><span class="n">pexpect</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="err">‘</span><span class="n">password</span><span class="err">’</span><span class="p">)</span>
</pre></div>


<p>Pexpect has just submitted my password which results in the ssh connection being successful. I then go back and forth over and over until it’s accomplished the task.</p>
<p>It’s quite a manual process and seems a bit “hacky” but it’s totally cool!</p>
<p><br></p>
<h3>The Run Function</h3>
<p>The <code>run</code> function is a little less exciting. It does what its name implies, run’s a command.</p>
<p>It’ll return the output of said command (if any).</p>
<p>It’s useful for things like kicking off a process or just starting or stopping a service. Pretty much anything that doesn’t really need the depth of the spawn class. For example:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pexpect</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">run</span><span class="p">(</span><span class="err">‘</span><span class="n">service</span> <span class="n">dhcp</span> <span class="n">restart</span><span class="err">’</span><span class="p">)</span>
<span class="n">run</span><span class="p">(</span><span class="err">‘</span><span class="n">cd</span> <span class="o">/</span><span class="n">repo</span> <span class="o">&amp;&amp;</span> <span class="n">git</span> <span class="n">pull</span><span class="p">)</span>
</pre></div>


<p>Standalone this isn’t mind blowing given we have <code>os.system</code> and even crontab but I love having multiple options when writing a script!</p>
<p><br></p>
<h2>Example</h2>
<p>As a one off, I wrote this script to ssh into my home NAS and manually kick off my <a href="https://github.com/pybites/100DaysOfCode/tree/master/033">drink water reminder emailer</a>:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pexpect</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="n">child</span> <span class="o">=</span> <span class="n">pexpect</span><span class="o">.</span><span class="n">spawn</span><span class="p">(</span><span class="s1">&#39;ssh user@192.1.1.0’)</span>
<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="n">child</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s1">&#39;user@10.1.1.10</span><span class="se">\&#39;</span><span class="s1">s password:&#39;</span><span class="p">)</span>
<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="n">child</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="err">‘</span><span class="n">password</span><span class="err">’</span><span class="p">)</span>
<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="n">child</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s1">&#39;# &#39;</span><span class="p">)</span>
<span class="n">child</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s1">&#39;cd /opt/development/drink_water &amp;&amp; /usr/bin/python3 water_reminder.py&#39;</span><span class="p">)</span>

<span class="n">child</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s1">&#39;# &#39;</span><span class="p">)</span>
<span class="n">child</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s1">&#39;exit&#39;</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="err">‘</span><span class="n">success</span><span class="err">!’</span><span class="p">)</span>
</pre></div>


<p><br></p>
<ul>
<li>
<p>I’ve put some quick <code>sleep</code>s in just to pause the script to allow time for the previous command to return.</p>
</li>
<li>
<p>Note the inclusion of the shell prompt <code>#</code> itself. This is actually necessary and indicates the return of the previous command.</p>
</li>
</ul>
<p><br></p>
<h2>Conclusion</h2>
<p>While some of these use cases are definitely solvable using other functions and modules I’m still impressed by the possibilities of Pexpect. It’s quite flexible given I’m able to code in the return expectation.</p>
<p>I could have <code>if</code> statements to account for different kinds of return values (true or false etc). If the <code>expect</code> is different to what I’m… expecting (ha!), then I’d re-run the previous command or just exit with a fail. Lot’s of interesting things to try!</p>
<p>And yes, I know, a lot of this has already been solved by cron. I love cron so I won’t argue with you. I will say that not everything is an OS with cron. Start thinking home automation and suddenly Pexpect seems a little more usable!</p>
<p>Do you use Pexpect for anything cool? Let me know! I’m thinking this would be good fun to use with my Raspberry Pi!</p>
<p>Keep Calm and Code in Python!</p>
<p>-- Julian</p>


    <div class="comments">
        <div id="disqus_thread"></div>
            <script type="text/javascript">
                var disqus_shortname = 'http-pybit-es';
                var disqus_identifier = 'pexpect.html';
                var disqus_url = './pexpect.html';
                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
            </script>
        <noscript>Please enable JavaScript to view the comments.</noscript>
    </div>
        
    </div>
        <!-- /Content --> 

        <!-- Footer -->
        <div class="footer gradient-2">
            <div class="container footer-container ">
                <div class="row">
                    <div class="col-xs-4 col-sm-3 col-md-3 col-lg-3">
                        <div class="footer-title">Sitemap</div>
                        <ul class="list-unstyled">
                            <li><a href="./pages/community.html">Community</a></li>
                            <li><a href=".https://codechalleng.es/100days/">100 Days Of Code</a></li>
                            <li><a href="./pages/search.html">Search</a></li>
                            <li><a href="./pages/privacy-policy.html">Privacy Policy</a></li>
                            <li><a href="https://pybit.es/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">Atom Feed</a></li>
                            <li><a href="https://pybit.es/feeds/all.rss.xml" type="application/rss+xml" rel="alternate">RSS Feed</a></li>
                        </ul>
                    </div>
                    <div class="col-xs-4 col-sm-3 col-md-3 col-lg-3">
                    </div>
                    <div class="col-xs-4 col-sm-3 col-md-3 col-lg-3">
                        <div class="footer-title">Reach Out</div>
                        <ul class="list-unstyled">
                            <li><a href="mailto:info@pybit.es" target="_blank">Email</a></li>
                            <li><a href="https://twitter.com/pybites" target="_blank">Twitter</a></li>
                            <li><a href="https://facebook.com/pybites" target="_blank">Facebook</a></li>
                            <li><a href="https://github.com/pybites" target="_blank">Github</a></li>
                            <li><a href="https://github.com/PyBites-Open-Source" target="_blank">Open Source</a></li>
                            <li><a href="https://www.youtube.com/channel/UCBn-uKDGsRBfcB0lQeOB_gA" target="_blank">YouTube</a></li>
                        </ul>
                    </div> 
                    <div class="col-xs-12 col-sm-3 col-md-3 col-lg-3">
                        <p class="pull-right text-right">
                            <small><em>Proudly powered by <a href="http://docs.getpelican.com/" target="_blank">pelican</a></em></small><br/>
                            <small><em>Theme and code by <a href="https://github.com/molivier" target="_blank">molivier</a></em></small><br/>
                            <small>&copy; PyBites 2016+</small>
                        </p>
                    </div>
                </div>
            </div>
        </div>
        <!-- /Footer -->
    </body>
</html>