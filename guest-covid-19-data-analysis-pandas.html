<!DOCTYPE html>
<html lang="en">
    <head>

        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="Some time ago, I was talking to Martin on the Pybites Slack about a challenge that involved the pandas library. I never really looked at data analysis, but triggered to complete the challenge...">
        <meta name="keywords" content="data analysis, guest, matplotlib, pandas">

        <meta property="og:site_name" content="PyBites"/>
        <meta property="og:title" content="Analyzing covid-19 data with pandas and matplotlib"/>
        <meta property="og:description" content="One moment I was solving a pandas challenge, next I was analyzing real world covid-19 data with python..."/>
        <meta property="og:locale" content="en_US"/>
        <meta property="og:url" content="https://pybit.es/guest-covid-19-data-analysis-pandas.html"/>
        <meta property="og:type" content="article"/>
        <meta property="article:published_time" content="2020-07-13 09:13:00+02:00"/>
        <meta property="article:modified_time" content=""/>
        <meta property="article:author" content="https://pybit.es/author/cedric-sambre.html">
        <meta property="article:section" content="Data"/>
        <meta property="article:tag" content="guest"/>
        <meta property="article:tag" content="pandas"/>
        <meta property="article:tag" content="matplotlib"/>
        <meta property="article:tag" content="data analysis"/>
        <meta property="og:image" content="https://pybit.es/theme/img/profile.png">

        <meta name="twitter:card" content="summary" />
        <meta name="twitter:site" content="@pybites" />
        <meta name="twitter:title" content="Analyzing covid-19 data with pandas and matplotlib" />
        <meta name="twitter:description" content="One moment I was solving a pandas challenge, next I was analyzing real world covid-19 data with python..." />
        <meta name="twitter:image" content="https://pybit.es/theme/img/profile.png" />

        <link rel="icon" href="https://pybit.es/favicon.ico">
        <title>Analyzing covid-19 data with pandas and matplotlib - PyBites</title>

        <!-- Stylesheets -->
        <link href="https://pybit.es/theme/css/all.min.css" rel="stylesheet">
        <link href="https://pybit.es/theme/css/style.css" rel="stylesheet">
        <!-- /Stylesheets -->

        <!-- RSS Feeds -->
        <link href="https://pybit.es/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="PyBites Full Atom Feed" />
        <link href="https://pybit.es/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="PyBites Full RSS Feed" />
        <link href="https://pybit.es/feeds/data.rss.xml" type="application/rss+xml" rel="alternate" title="PyBites Categories RSS Feed" />
        <!-- /RSS Feeds -->

        <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
          <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
          <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->

          <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5859c6a67eb6254d" async="async"></script>

        <!-- Google Analytics -->
        <script>
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

          ga('create', 'UA-89294245-1', 'auto');
          ga('send', 'pageview');
        </script>
        <!-- /Google Analytics -->



    <!-- mailchimp subscribe -->
    <script type="text/javascript" src="//downloads.mailchimp.com/js/signup-forms/popup/unique-methods/embed.js" data-dojo-config="usePlainJson: true, isDebug: false"></script><script type="text/javascript">window.dojoRequire(["mojo/signup-forms/Loader"], function(L) { L.start({"baseUrl":"mc.us14.list-manage.com","uuid":"822043293f280259d4b8d2a3e","lid":"ac7e2eb9ef","uniqueMethods":true}) })</script>
    <!-- end mailchimp subscribe -->

    <!-- Facebook Pixel Code -->
    <script>
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};
    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
    n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t,s)}(window, document,'script',
    'https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', '767652523960315');
    fbq('track', 'PageView');
    </script>
    <noscript><img height="1" width="1" style="display:none"
    src="https://www.facebook.com/tr?id=767652523960315&ev=PageView&noscript=1"
    /></noscript>
    <!-- End Facebook Pixel Code -->

    </head>

    <body>

        <!-- Header -->
    <div class="header-container gradient">

            <!-- Static navbar -->
            <div class="container">
                <div class="header-nav">
                    <div class="header-logo">
                        <a class="pull-left" href="https://pybit.es/"><img class="mr20" src="https://pybit.es/images/logo.png" alt="logo"></a>
                    </div>
                    <div class="nav pull-right">

                        <div class="dropdown">
                          <span>RESOURCES</span>
                          <div class="dropdown-content">
                                <a href="https://www.pybitespodcast.com/"
                                    target="_blank"
                                >Podcast</a>
                                <a href="/community"
                                >Community</a>
                                <a href="/friends"
                                >Friends List</a>
                                <a href="/archives"
                                >Blog Articles</a>
                                <a href="/category/challenges"
                                >Blog Code Challenges</a>
                                <a href="https://github.com/PyBites-Open-Source"
                                    target="_blank"
                                >PyBites Open Source</a>
                                <a href="https://www.udemy.com/course/python-flask-for-beginners/"
                                    target="_blank"
                                >Flask Intro Course</a>
                                <a href="/100days"
                                >#100DaysOfCode</a>
                                <a href="https://codechalleng.es/tips"
                                    target="_blank"
                                >Weekly Email Tips</a>
                          </div>
                        </div>

                        <div class="dropdown">
                          <span>SERVICES</span>
                          <div class="dropdown-content">
                                <a href="https://codechalleng.es"
                                    target="_blank"
                                >Platform</a>
                                <a href="https://pybit.es/tips"
                                    target="_blank"
                                >Tips Book</a>
                                <a href="https://members.pybit.es/offers/mfFWRKHG/checkout"
                                    target="_blank"
                                >Python Intro Course</a>
                                <a href="https://pybitesproductivity.com/"
                                    target="_blank"
                                >Productivity Course</a>
                          </div>
                        </div>

                        <div class="dropdown">
                          <a href="https://pybitesdevelopermindset.com/" id="workshopButton" target="_blank">Python Coaching</a>
                        </div>

                    </div>
                </div>
            </div>
            <!-- /Static navbar -->

            <!-- Header -->
    <!-- Header -->
    <div class="container header-wrapper">
        <div class="row">
              <div class="col-lg-12">
                  <div class="header-content">
                      <h1 class="header-title">Analyzing covid-19 data with pandas and matplotlib</h1>
                      <p class="header-date"> <a href="https://pybit.es/author/cedric-sambre.html">Cedric Sambre</a>, Mon 13 July 2020,  <a href="https://pybit.es/category/data.html">Data</a></p>
                      <div class="header-underline"></div>
                      <div class="clearfix"></div>
                      <p class="pull-right header-tags">
                          <span class="glyphicon glyphicon-tags mr5" aria-hidden="true"></span>
<a href="https://pybit.es/tag/data-analysis.html">data analysis</a>, <a href="https://pybit.es/tag/guest.html">guest</a>, <a href="https://pybit.es/tag/matplotlib.html">matplotlib</a>, <a href="https://pybit.es/tag/pandas.html">pandas</a>                      </p>
                  </div>
              </div>
        </div>
    </div>
    <!-- /Header -->
            <!-- /Header -->

        </div>
        <!-- /Header -->


        <!-- Content -->
    <div class="container content">
        <p>Some time ago, I was talking to <a href="https://twitter.com/clamytoe">Martin</a> on the <a href="https://pybit.es/pages/community.html">Pybites Slack</a> about a challenge that involved the <code>pandas</code> library.</p>
<p>I never really looked at data analysis, but triggered to complete the challenge ahead, I dove into the library and immediately noticed how strong it was to manage large data collections.</p>
<p>Throughout this article we'll have a basic look at collecting data to handle with pandas, normalizing it so that it becomes more representative, and I'll have a small stop at Jupyter notebooks. </p>
<h1>Index</h1>
<ul>
<li><a href="#requirements">Requirements</a></li>
<li><a href="#disclaimer">Disclaimer</a></li>
<li><a href="#getting-data">Part 1: Getting Data</a></li>
<li><a href="#forest-trees">Part 2: The forest and the trees</a> </li>
<li><a href="#normal-not-normal">Part 3: This isn't normal, is it?</a></li>
<li><a href="#conclusion">Conclusion</a></li>
</ul>
<h5>Disclaimer</h5>
<p>This document is just a resource to demonstrate a python programming library on data that is actual.</p>
<p>I'm not a data analyst nor a virologist, I'm just someone who likes to explore data and who loves to create tools doing so.
There are some calculations that I have made in this document that can be made more statistically accurate, I'm <em>just playing around</em>.</p>
<p>For correct and up to date information regarding Covid-19, please visit your local governments website.</p>
<p><a name="getting-data"></a></p>
<h3>Part 1: Getting Data</h3>
<p>If you open a newspaper nowadays, you get shown a lot of numbers regarding the evolution of the Covid-19 virus.
All data regarding new infections, new deaths, testing and a lot of other things, are all stored by the WHO, the ECDC and the John Hopkins Institute.</p>
<p>Lucky for us, <a href="https://ourworldindata.org/">OWID (Our World In Data)</a> already created collections of the WHO and ECDC data.
These collections are stored on <a href="https://github.com/owid/covid-19-data/tree/master/public/data">their github</a>.</p>
<p>If you open the repo, you'll notice there's a <code>last-updated-timestamp.txt</code> file that looks like this:</p>
<p><img alt="Timestamp File" src="images/guest-covid-19-data-analysis-pandas/timestamp-file.png"></p>
<p>That's actually great! Why?</p>
<p>This timestamp represents the last update of the data collection.
If we download the data and the timestamp once, we can simply check this 19 byte file if it has changed rather than having to compare the 15.6 MB Json blob manually every time we want to validate our data.</p>
<p>What's also nice is that this is a representation in ISO format, which can be handily loaded in a <code>datetime</code> in python:</p>
<div class="highlight"><pre><span></span>     <span class="k">if</span> <span class="nv">os</span>.<span class="nv">path</span>.<span class="nv">exists</span><span class="ss">(</span><span class="nv">TIMESTAMP_TMP</span><span class="ss">)</span>:
        <span class="nv">with</span> <span class="nv">open</span><span class="ss">(</span><span class="nv">TIMESTAMP_TMP</span>, <span class="s2">&quot;</span><span class="s">r</span><span class="s2">&quot;</span><span class="ss">)</span> <span class="nv">as</span> <span class="nv">_tsf</span>:
            <span class="nv">current_timestamp</span> <span class="o">=</span> <span class="nv">_tsf</span>.<span class="nv">read</span><span class="ss">()</span>
        <span class="nv">current_datetime</span> <span class="o">=</span> <span class="nv">datetime</span>.<span class="nv">fromisoformat</span><span class="ss">(</span><span class="nv">current_timestamp</span><span class="ss">)</span>  
</pre></div>


<p>Next, all we have to do is compare the date in the local file against the date in the remote file:</p>
<div class="highlight"><pre><span></span>    <span class="k">with</span> <span class="n">requests</span><span class="p">.</span><span class="k">Session</span><span class="p">()</span> <span class="k">as</span> <span class="n">_sess</span><span class="p">:</span>
        <span class="n">new_timestamp</span> <span class="o">=</span> <span class="n">_sess</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="n">TIMETAMP_URL</span><span class="p">).</span><span class="nb">text</span>
    <span class="n">new_datetime</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">new_timestamp</span><span class="p">)</span>
</pre></div>


<p>And if these differ, we can download the data to our data folder! </p>
<p>Have a look at <code>datafetcher.py</code> on <a href="https://github.com/jarviscodes/covid-19-view/blob/master/code/datafetcher.py">my github</a> to see how I pulled all this together.</p>
<p><a name="forest-trees"></a></p>
<h3>Part 2: The forest and the trees.</h3>
<p>In Dutch there's a saying: </p>
<blockquote>
<p>"You can't see the forest through the trees anymore".</p>
</blockquote>
<p>Which means that a lot of data dancing in front of your eyes can cause you to completely miss the bigger picture the data is portraying.</p>
<h4>Pandas</h4>
<p>Great, we have the data!</p>
<p>JSON is pretty clearly structured and in many cases, it's more than sufficient to use in your python code.
However, if you open the json file, you can see that there are hundreds of entries that are nested into the hundred country codes.</p>
<p>When working with data that's this size, things get complicated fast.</p>
<p>In comes <code>pandas</code>!</p>
<p>Pandas is described as follows on the package website:</p>
<blockquote>
<p>pandas is a Python package providing fast, flexible, and expressive data structures designed to make working with “relational” or “labeled” data both easy and intuitive. It aims to be the fundamental high-level building block for doing practical, real world data analysis in Python.</p>
</blockquote>
<p>In short, pandas provides ways to make working with large data programmatically accessible.</p>
<p>One example would be a <code>DataFrame</code>, which you can see as some sort of table object with a lot of information about the content.
It can have indexes and column names to address or group data properly, which is exactly what we are going to be using.</p>
<p>Here's an example pprinted dataframe, so you can get an idea what they look like.</p>
<div class="highlight"><pre><span></span>                 <span class="nb">date</span>  <span class="n">new_cases</span>  <span class="n">stringency_index</span>
<span class="nb">date</span>                                              
<span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">31</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">31</span>        <span class="mi">0</span><span class="p">.</span><span class="mi">0</span>               <span class="n">NaN</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span>        <span class="mi">0</span><span class="p">.</span><span class="mi">0</span>              <span class="mi">0</span><span class="p">.</span><span class="mi">00</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">02</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">02</span>        <span class="mi">0</span><span class="p">.</span><span class="mi">0</span>              <span class="mi">0</span><span class="p">.</span><span class="mi">00</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">03</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">03</span>        <span class="mi">0</span><span class="p">.</span><span class="mi">0</span>              <span class="mi">0</span><span class="p">.</span><span class="mi">00</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">04</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">04</span>        <span class="mi">0</span><span class="p">.</span><span class="mi">0</span>              <span class="mi">0</span><span class="p">.</span><span class="mi">00</span>
<span class="p">...</span>               <span class="p">...</span>        <span class="p">...</span>               <span class="p">...</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">08</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">08</span>       <span class="mi">65</span><span class="p">.</span><span class="mi">0</span>             <span class="mi">42</span><span class="p">.</span><span class="mi">59</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">09</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">09</span>       <span class="mi">87</span><span class="p">.</span><span class="mi">0</span>             <span class="mi">42</span><span class="p">.</span><span class="mi">59</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">10</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">10</span>        <span class="mi">0</span><span class="p">.</span><span class="mi">0</span>               <span class="n">NaN</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">11</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">11</span>      <span class="mi">259</span><span class="p">.</span><span class="mi">0</span>               <span class="n">NaN</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">12</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">12</span>      <span class="mi">137</span><span class="p">.</span><span class="mi">0</span>               <span class="n">NaN</span>

<span class="p">[</span><span class="mi">195</span> <span class="k">rows</span> <span class="n">x</span> <span class="mi">3</span> <span class="n">columns</span><span class="p">]</span>
</pre></div>


<p>You can see that the dataframe knows the shape of our data (195x3), it has a date index and column names.</p>
<p>There's also a bunch of methods that are being exposed to inspect your data.</p>
<p>The <code>head()</code> function for example, shows a specified number of records of the dataframe you apply it to:</p>
<p>So let's say that instead of printing the entire dataset, I would print <code>df_slice.head(5)</code>, the result would be this:</p>
<div class="highlight"><pre><span></span>                 <span class="n">date</span>  <span class="n">new_cases</span>  <span class="n">stringency_index</span>
<span class="n">date</span>                                              
<span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">31</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">31</span>        <span class="mf">0.0</span>               <span class="n">NaN</span>
<span class="mi">2020</span><span class="o">-</span><span class="mo">01</span><span class="o">-</span><span class="mo">01</span> <span class="mi">2020</span><span class="o">-</span><span class="mo">01</span><span class="o">-</span><span class="mo">01</span>        <span class="mf">0.0</span>               <span class="mf">0.0</span>
<span class="mi">2020</span><span class="o">-</span><span class="mo">01</span><span class="o">-</span><span class="mo">02</span> <span class="mi">2020</span><span class="o">-</span><span class="mo">01</span><span class="o">-</span><span class="mo">02</span>        <span class="mf">0.0</span>               <span class="mf">0.0</span>
<span class="mi">2020</span><span class="o">-</span><span class="mo">01</span><span class="o">-</span><span class="mo">03</span> <span class="mi">2020</span><span class="o">-</span><span class="mo">01</span><span class="o">-</span><span class="mo">03</span>        <span class="mf">0.0</span>               <span class="mf">0.0</span>
<span class="mi">2020</span><span class="o">-</span><span class="mo">01</span><span class="o">-</span><span class="mo">04</span> <span class="mi">2020</span><span class="o">-</span><span class="mo">01</span><span class="o">-</span><span class="mo">04</span>        <span class="mf">0.0</span>               <span class="mf">0.0</span>
</pre></div>


<p>And this is just a small example of what you can do with pandas!</p>
<h4>Jupyter</h4>
<p>I want to dedicate a small section to Jupyter Notebooks!</p>
<p>For people who commonly work with data, <code>Jupyter</code> will likely be a very familiar tool, for others that struggle with <code>pprint</code>'ed <code>df.head()</code>'s, a new door might open. 
Jupyter notebooks are basically python powered scratchpads.</p>
<p>The notebook I used for this project will also be on <a href="https://github.com/jarviscodes/covid-19-view">my github</a>.
But honestly, take this thing as the scratchpad that it is where I randomly try to correlate stuff ;-)</p>
<p><code>Jupyter</code> has support for <code>matplotlib</code> and <code>pandas</code> which make it awesome to use for analyzing data:</p>
<p>Here's an example representation of a <code>df.head()</code>:</p>
<p><img alt="df.head example" src="images/guest-covid-19-data-analysis-pandas/jupyter_head.png"></p>
<p>Or just a plot:</p>
<p><img alt="matplotlib example" src="images/guest-covid-19-data-analysis-pandas/jupyter_matplotlib.png"></p>
<p>Of course you can do this with just regular scripts, but I personally think that these 2 integrations alone make jupyter a must-have for data analysis!</p>
<p>If you would like to run the Notebook from my github, you can simply install jupyter:</p>
<p><code>pip3 install jupyter</code></p>
<p>Next, you clone the entire github repo:</p>
<p><code>git clone https://github.com/jarviscodes/covid-19-view.git</code></p>
<p>Now you launch jupyter by running:</p>
<p><code>jupyter notebook</code></p>
<p>And in jupyter in your browser you can navigate to the <code>covid-19-view/code/</code> directory and open <code>Notebook-covid19.ipynb</code>.</p>
<p>It should look like this:</p>
<p><img alt="Notebook opened" src="images/guest-covid-19-data-analysis-pandas/notebook_open.png"> </p>
<p>You can make modifications to the notebook as you please.</p>
<p><a name="normal-not-normal"></a></p>
<h3>Part 3: This isn't normal, is it?</h3>
<h4>Badum.. tss...</h4>
<p>While scratching around on my Jupyter notebook, I noticed something called "the stringency index".
A few Google searches later, I learned the <a href="https://ourworldindata.org/grapher/covid-stringency-index">definition</a>.</p>
<blockquote>
<p>The Government Response Stringency Index is a composite measure based on nine response indicators
including school closures, workplace closures, and travel bans, rescaled to a value from 0 to 100 (100 =
strictest response).</p>
</blockquote>
<p>It would seem to me, that the stricter your government was, the more the general curve of new cases would go down. </p>
<p>Let's plot the data !</p>
<div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;line&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;new_cases&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;line&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;stringency_index&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
</pre></div>


<p>Aaaand...</p>
<p><img alt="Cases to stringency" src="images/guest-covid-19-data-analysis-pandas/stringency_newcases_nonorm.png"></p>
<p>The result is completely anticlimactic!</p>
<h5>The graph, it speaks.</h5>
<p>The way the graph looks, it's very hard to tell if the Belgium was stricter in it's policies at some time or not.</p>
<p>This phenomenon can be explained by the fact that the units of the stringency index and the new cases are completely unrelated.</p>
<p>The stringency index is a value between 0 and 100. Where the new cases is any number between 0 and the total uninfected population.</p>
<p>For Belgium, at the time of writing, the maximum stringency index was at 81.48% strictness.
If we take this as the maximum stringency index (although not entirely correct since max would be 100), we can use this value to calculate the relation between the stringency index and the new_cases.
This ratio can then be used to plot the stringency graph so that the relation between the 2 becomes more apparent.</p>
<div class="highlight"><pre><span></span><span class="n">df_stringency_max</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;stringency_index&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="n">df_newcases_max</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;new_cases&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

<span class="c1"># Calculate the stringency to new_cases ratio</span>
<span class="n">stringency_newcases_ratio</span> <span class="o">=</span> <span class="n">df_newcases_max</span> <span class="o">/</span> <span class="n">df_stringency_max</span>

<span class="c1"># Add a column for the related values</span>

<span class="n">df</span><span class="p">[</span><span class="s1">&#39;stringency_to_case_ratio&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;stringency_index&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">stringency_newcases_ratio</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;line&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;new_cases&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;line&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;stringency_to_case_ratio&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
</pre></div>


<p><img alt="Normalized graph" src="images/guest-covid-19-data-analysis-pandas/stringency_newcases_norm.png"></p>
<p>As you can see between the previous new_cases graph and this one, a new spike in cases is apparent.
But it's hard to tell if the stringency really has an influence on these new cases.</p>
<h4>But why?</h4>
<p>With the recent decrease in anti-covid measurements (schools and stores have reopened etc), we can see that the numbers appear to be rising again.
There are however now clear turning points for some reason.</p>
<p>And theres something else...</p>
<h4>Why does it bounce?</h4>
<p>As mentioned before, I'm just a simple programmer, not a virologist or a genius in statistics.
But as a programmer, I think it's only logic that if you add <code>infected * spread_rate</code> with <code>current_uninfected</code> you'd get a rather smooth line that turns as the <code>spread_rate</code> changes.</p>
<p>The graph for Belgium's new cases isn't smooth at all. 
It's jagged which basically means that one day there's a lot of new cases, and the next day there's very little.</p>
<p>I manually took a small cut of the dataframe to see if the numbers would make any sense.
So I split a set where I noticed heavy bouncing, and drew it out:</p>
<div class="highlight"><pre><span></span><span class="n">weird_bounce</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="s1">&#39;2020-06-10&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="s1">&#39;2020-06-30&#39;</span><span class="p">)]</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">weird_bounce</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;line&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;new_cases&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">weird_bounce</span>
</pre></div>


<p><img alt="Strange Bounce" src="images/guest-covid-19-data-analysis-pandas/strange_bounce.png"></p>
<p>And in numbers:</p>
<p><img alt="Strange Bounce Numbers" src="images/guest-covid-19-data-analysis-pandas/lower_cases_marked.png"></p>
<p>Not coincidentally, some of these drops are on saturdays and sundays, with a slight increase after the weekend.
This was caused by the tests not always being conducted in the labs on weekends, but of course, there's days like Thursday the 25th of June where there's a drop from ~90 to 13 new cases for no reason at all.</p>
<p>In order to normalize these results, in this case, it would be appropriate to take the average on a per-week basis.
Allthough part of me feels that we should fill in the averages of the week on the days of the drops.</p>
<p>Just because tests have not been conducted does not mean the virus has stopped spreading.
I think these types of speculations are interesting to look at, but I'll just work with the data we have, for now. :-)</p>
<p>So we take a new slice, group the slice by week and take the mean of the rest of the values. </p>
<div class="highlight"><pre><span></span><span class="n">df_slice</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="s2">&quot;new_cases&quot;</span><span class="p">,</span> <span class="s2">&quot;stringency_index&quot;</span><span class="p">,</span> <span class="s2">&quot;stringency_to_case_ratio&quot;</span><span class="p">]]</span>
<span class="n">df_grouped</span> <span class="o">=</span> <span class="n">df_slice</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">pd</span><span class="o">.</span><span class="n">Grouper</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;W-MON&#39;</span><span class="p">)])</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">df_grouped</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;line&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;new_cases&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;line&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;stringency_to_case_ratio&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
</pre></div>


<p>Which produces the following result:</p>
<p><img alt="Normalized mean week" src="images/guest-covid-19-data-analysis-pandas/normalized_mean_week.png"></p>
<p>Now there's 2 more 'problems' that have been introduced.</p>
<p>The stringency to case ratio is still calculated on the max of the new cases without the 'normalization' of the bouncing data.</p>
<div class="highlight"><pre><span></span><span class="n">df_slice</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="s2">&quot;new_cases&quot;</span><span class="p">,</span> <span class="s2">&quot;stringency_index&quot;</span><span class="p">]]</span>
<span class="n">df_grouped</span> <span class="o">=</span> <span class="n">df_slice</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">pd</span><span class="o">.</span><span class="n">Grouper</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;W-MON&#39;</span><span class="p">)])</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="n">df_stringency_max</span> <span class="o">=</span> <span class="n">df_grouped</span><span class="p">[</span><span class="s1">&#39;stringency_index&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="n">df_newcases_max</span> <span class="o">=</span> <span class="n">df_grouped</span><span class="p">[</span><span class="s1">&#39;new_cases&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

<span class="c1"># Calculate the stringency to new_cases ratio</span>
<span class="n">stringency_newcases_ratio</span> <span class="o">=</span> <span class="n">df_newcases_max</span> <span class="o">/</span> <span class="n">df_stringency_max</span>

<span class="n">df_grouped</span><span class="p">[</span><span class="s1">&#39;stringency_to_case_ratio&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_grouped</span><span class="p">[</span><span class="s1">&#39;stringency_index&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">stringency_newcases_ratio</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">df_grouped</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;line&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;new_cases&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">df_grouped</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;line&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;stringency_to_case_ratio&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
</pre></div>


<p><img alt="New ratio" src="images/guest-covid-19-data-analysis-pandas/normalized_mean_week_ratio.png"></p>
<p>The next problem is that the stringency is now also represented by it's average over different weeks, and this is not entirely correct.
The Belgian government has meetings every week, and then makes decisions based on that weeks numbers so the decisions are rather sudden.</p>
<p>We can solve this by changing this line:</p>
<p><code>df_grouped['stringency_to_case_ratio'] = df_grouped['stringency_index'] * stringency_newcases_ratio</code></p>
<p>Into this:</p>
<p><code>df_grouped['stringency_to_case_ratio'] = df['stringency_index'] * stringency_newcases_ratio</code></p>
<p>Now we will multiply the original stringency index with the ratio calculated with the max value of the mean of the new cases (phew).</p>
<p><img alt="Stringency Corrected" src="images/guest-covid-19-data-analysis-pandas/stringency_corrected.png"></p>
<p>Now the graph represents the decisions taken as sudden as they are by showing less rounded corners.</p>
<p><a name="conclusion"></a></p>
<h3>Conlusion</h3>
<p>Although pandas and data analysis in general were quite far from my comfort zone, I managed to get nice results with relatively little code.
It was really a fun puzzle to connect the numbers to reality and figure out why new case reports were dipping for example.</p>
<p>Both <code>pandas</code> and <code>matplotlib</code> can be very powerful tools to analyse all sorts of data and seeing the bigger picture.</p>
<p>-- <a href="pages/guests.html#cedricsambre">Cedric</a></p>


<div id="pbproducts">
  <h3>PyBites Python Tips</h3>
  <div>
    <p>Do you want to get <strong>250+ concise and applicable Python tips</strong> in an ebook that will cost you less than 10 bucks (future updates included), check it out <a href="https://gumroad.com/l/pbtips" target="_blank">here</a>.</p>
    <p>
      <a href="https://gumroad.com/l/pbtips" target="_blank">
        <img src="https://codechalleng.es/static/img/tips-book-thumb.07692e3ba331.png" alt="Get our Python Tips Book">
      </a>
    </p>

    <div id="testimonials">
      <p><i>"The discussions are succinct yet thorough enough to give you a solid grasp of the particular problem. I just wish I would have had this book when I started learning Python." - Daniel H </i></p>
      <p><i>"Bob and Julian are the masters at aggregating these small snippets of code that can really make certain aspects of coding easier." - Jesse B </i></p>
      <p><i>"This is now my favourite first Python go-to reference." - Anthony L </i></p>
      <p><i>"Do you ever go on one of those cooking websites for a recipe and have to scroll for what feels like an eternity to get to the ingredients and the 4 steps the recipe actually takes? This is the opposite of that." - Sergio S </i></p>
      <p class="buttonWrapper">
        <a class="button" href="https://gumroad.com/l/pbtips" target="_blank">
          Get the book
        </a>
      </p>
    </div>
  </div>
</div>    <div class="comments">
        <div id="disqus_thread"></div>
            <script type="text/javascript">
                var disqus_shortname = 'http-pybit-es';
                var disqus_identifier = 'guest-covid-19-data-analysis-pandas.html';
                var disqus_url = 'https://pybit.es/guest-covid-19-data-analysis-pandas.html';
                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
            </script>
        <noscript>Please enable JavaScript to view the comments.</noscript>
    </div>
        
    </div>
        <!-- /Content --> 

        <!-- Footer -->
        <div class="footer gradient-2">
            <div class="container footer-container ">
                <div class="row">
                    <div class="col-xs-4 col-sm-3 col-md-3 col-lg-3">
                        <div class="footer-title">Sitemap</div>
                        <ul class="list-unstyled">
                            <li><a href="https://pybit.es/pages/guests.html">Authors</a></li>
                            <li><a href="https://pybit.es/pages/community.html">Community</a></li>
                            <li><a href="https://pybit.es/100days">#100DaysOfCode</a></li>
                            <li><a href="https://pybit.es/pages/search.html">Search</a></li>
                            <li><a href="https://pybit.es/pages/privacy-policy.html">Privacy Policy</a></li>
                              <li><a href="https://pybit.es/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">Atom Feed</a></li>
                              <li><a href="https://pybit.es/feeds/all.rss.xml" type="application/rss+xml" rel="alternate">RSS Feed</a></li>
                            <li><a href="mailto:support@pybit.es" title="Contact us by email">Contact Us</a></li>
                        </ul>
                    </div>
                    <div class="col-xs-4 col-sm-3 col-md-3 col-lg-3">
                    </div>
                    <div class="col-xs-4 col-sm-3 col-md-3 col-lg-3">
                        <div class="footer-title">Reach Out</div>
                        <ul class="list-unstyled">
                            <li><a href="mailto:support@pybit.es" target="_blank">Email</a></li>
                            <li><a href="https://twitter.com/pybites" target="_blank">Twitter</a></li>
                            <li><a href="https://facebook.com/pybites" target="_blank">Facebook</a></li>
                            <li><a href="https://github.com/pybites" target="_blank">Github</a></li>
                            <li><a href="https://github.com/PyBites-Open-Source" target="_blank">Open Source</a></li>
                            <li><a href="https://www.youtube.com/channel/UCBn-uKDGsRBfcB0lQeOB_gA" target="_blank">YouTube</a></li>
                        </ul>
                    </div> 
                    <div class="col-xs-12 col-sm-3 col-md-3 col-lg-3">
                        <p class="pull-right text-right">
                            <small><em>Proudly powered by <a href="http://docs.getpelican.com/" target="_blank">pelican</a></em></small><br/>
                            <small><em>Theme and code by <a href="https://github.com/molivier" target="_blank">molivier</a></em></small><br/>
                            <small>&copy; PyBites 2016+</small>
                        </p>
                    </div>
                </div>
            </div>
        </div>
        <!-- /Footer -->
    </body>
</html>