
<!DOCTYPE html>
<html lang="en">
<head>
  <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,400italic' rel='stylesheet' type='text/css'>

    <link rel="stylesheet" type="text/css" href="http://pybit.es/theme/stylesheet/style.min.css">
  <link rel="stylesheet" type="text/css" href="http://pybit.es/theme/pygments/github.min.css">
  <link rel="stylesheet" type="text/css" href="http://pybit.es/theme/font-awesome/css/font-awesome.min.css">
  <link rel="stylesheet" type="text/css" href="//cdn-images.mailchimp.com/embedcode/classic-10_7.css">
  <link rel="stylesheet" type="text/css" href="http://pybit.es/theme/stylesheet/custom.css">



    <link rel="shortcut icon" href="http://pybit.es/favicon.ico" type="image/x-icon">
    <link rel="icon" href="http://pybit.es/favicon.ico" type="image/x-icon">

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="" />


<meta name="author" content="PyBites" />
<meta name="description" content="It's end of the week again so we review the code challenge of this week. It's never late to sign up, just fork our challenges repo and start coding." />
<meta name="keywords" content="codechallenges, code review, learning, nlp, Twitter, twitterapi, gensim, nltk">
<meta property="og:site_name" content="PyBites"/>
<meta property="og:title" content="Code Challenge 05 - Twitter data analysis Part 2: similar tweeters - Review"/>
<meta property="og:description" content="It's end of the week again so we review the code challenge of this week. It's never late to sign up, just fork our challenges repo and start coding."/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="http://pybit.es/codechallenge05_review.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2017-02-10 23:00:00+01:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="http://pybit.es/author/pybites.html">
<meta property="article:section" content="Challenges"/>
<meta property="article:tag" content="codechallenges"/>
<meta property="article:tag" content="code review"/>
<meta property="article:tag" content="learning"/>
<meta property="article:tag" content="nlp"/>
<meta property="article:tag" content="Twitter"/>
<meta property="article:tag" content="twitterapi"/>
<meta property="article:tag" content="gensim"/>
<meta property="article:tag" content="nltk"/>
<meta property="og:image" content="http://pybit.es/images/featured/pb-challenge.png">

<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@pybites" />
<meta name="twitter:title" content="Code Challenge 05 - Twitter data analysis Part 2: similar tweeters - Review" />
<meta name="twitter:description" content="It's end of the week again so we review the code challenge of this week. It's never late to sign up, just fork our challenges repo and start coding." />
<meta name="twitter:image" content="http://pybit.es/images/featured/pb-challenge.png">

  <title>PyBites &ndash; Code Challenge 05 - Twitter data analysis Part 2: similar tweeters - Review</title>


</head>
<body>

  <!-- change aside color based on article vs challenge vs news -->
    <aside class='red'>

    <div>
      <a href="http://pybit.es">

			<img src="http://pybit.es/theme/img/challenges.png" alt="PyBites" title="PyBites">

      </a>
      <h1><a href="http://pybit.es">PyBites</a></h1>

<p>Python Code Challenges, Articles and News - One Bite a Day</p>
      <nav>
        <ul class="list">
          <li><a href="http://pybit.es/pages/about.html">About</a></li>
          <li><a href="http://pybit.es/pages/articles.html">Articles</a></li>
          <li><a href="http://pybit.es/pages/challenges.html">Challenges</a></li>
          <li><a href="http://pybit.es/pages/news.html">News</a></li>
          <li><a href="http://pybit.es/pages/search.html">Search</a></li>

        </ul>
      </nav>


	  <a class="twitter-follow-button" href="https://twitter.com/pybites"
	  	data-show-screen-name="false" data-size="large" data-show-count="false"> 
		Follow @pybites</a>

	
    </div>


  </aside>
  <main>


<article class="single">
  <header>
    <h1 id="codechallenge05_review">Code Challenge 05 - Twitter data analysis Part 2: similar tweeters - Review</h1>
    <p>
          Posted by <a href="http://pybit.es/author/pybites.html">PyBites</a> on Fri 10 February 2017 in <a href="http://pybit.es/category/challenges.html">Challenges</a>


        &#8226; 3 min read
    </p>
  </header>


  <div>
    <p>It's end of the week again so we review the <a href="http://pybit.es/codechallenge05.html">code challenge of this week</a>. It's never late to join, just fork our <a href="https://github.com/pybites/challenges">challenges repo</a> and start coding.</p>
<h2>Learning</h2>
<p>This week's challenge was really hard. We looked at <a href="https://radimrehurek.com/gensim/">Gensim</a> to calculate similarity between Twitter users.</p>
<p>Below what we got. Any feedback welcome. Code is <a href="https://github.com/pybites/challenges/blob/solutions/05/">here</a>.</p>
<ul>
<li>
<p>First we tweaked usertweets.py from last week to download 200 tweets of 15 users and store them as csv files in the data/ subdirectory. Users are mostly Pythonistas, but also some unrelated. We changed the solution a bit: instead of comparing only two users, we rank similarity of one user of the set against all others.</p>
</li>
<li>
<p>We load all tweets per user in with get_user_tokens() and tokenize them with: </p>
<div class="highlight"><pre><span></span>def tokenize_text(words):
    words = [word for word in words if len(word) &gt; 4 and word not in STOPWORDS]
    words = [word for word in words if _is_ascii(word)]
    words = [word for word in words if not IS_LINK_OBJ.search(word)]
    return words
</pre></div>


<p>Where IS_LINK_OBJ discards links and mentions:</p>
<div class="highlight"><pre><span></span>IS_LINK_OBJ = re.compile(r&#39;^(?:@|https?://)&#39;)
</pre></div>


<p>We get stopwords from nltk:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nltk.corpus</span> <span class="kn">import</span> <span class="n">stopwords</span>
<span class="n">STOPWORDS</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">stopwords</span><span class="o">.</span><span class="n">words</span><span class="p">(</span><span class="s1">&#39;english&#39;</span><span class="p">))</span>
</pre></div>


<p>The underscore methods are helpers. We assigned lambdas to variables, but flake8 complained, so better methods :)</p>
</li>
<li>
<p>Then we use Gensim to compare a user against the set. This took quite some effort, hopefully our method is correct, the results (see further down) look promosing. We partially used <a href="http://stackoverflow.com/questions/22433884/python-gensim-how-to-calculate-document-similarity-using-the-lda-model">this thread</a>.</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gensim</span> <span class="kn">import</span> <span class="n">corpora</span><span class="p">,</span> <span class="n">models</span><span class="p">,</span> <span class="n">similarities</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">du</span> <span class="ow">in</span> <span class="n">diff_users</span><span class="p">:</span>  <span class="c1"># globbing csv files in data/ or provided with sys.argv[1:]</span>
    <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_user_tokens</span><span class="p">(</span><span class="n">du</span><span class="p">))</span>
<span class="n">dictionary</span> <span class="o">=</span> <span class="n">corpora</span><span class="o">.</span><span class="n">Dictionary</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="n">corpus</span> <span class="o">=</span> <span class="p">[</span><span class="n">dictionary</span><span class="o">.</span><span class="n">doc2bow</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="k">for</span> <span class="n">text</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>
<span class="n">lda</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ldamodel</span><span class="o">.</span><span class="n">LdaModel</span><span class="p">(</span><span class="n">corpus</span><span class="p">,</span> <span class="n">num_topics</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                            <span class="n">id2word</span><span class="o">=</span><span class="n">dictionary</span><span class="p">,</span> <span class="n">passes</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

<span class="n">index</span> <span class="o">=</span> <span class="n">similarities</span><span class="o">.</span><span class="n">MatrixSimilarity</span><span class="p">(</span><span class="n">lda</span><span class="p">[</span><span class="n">corpus</span><span class="p">])</span>

<span class="n">tokens</span> <span class="o">=</span> <span class="n">get_user_tokens</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
<span class="n">vec_bow</span> <span class="o">=</span> <span class="n">dictionary</span><span class="o">.</span><span class="n">doc2bow</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span>
<span class="n">vec_lda</span> <span class="o">=</span> <span class="n">lda</span><span class="p">[</span><span class="n">vec_bow</span><span class="p">]</span>

<span class="n">sims</span> <span class="o">=</span> <span class="n">index</span><span class="p">[</span><span class="n">vec_lda</span><span class="p">]</span>
<span class="n">sims</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">sims</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="o">-</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sim</span> <span class="ow">in</span> <span class="n">sims</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">diff_users</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">sim</span><span class="p">)</span>
</pre></div>


<p>Full code <a href="https://github.com/pybites/challenges/blob/solutions/05/">here</a>.</p>
</li>
<li>
<p>Interestingly this model worked kind of ok, but got different results upon running and not much polarity. It turned out that the sample Twitter set (200 tweets per user) was too small, so we created a data/new directory and used <a href="https://gist.github.com/yanofsky/5436496">yanofsky's awesome tweet_dumper</a> to get 3200 tweets per user. </p>
<p>Data set before vs after:</p>
<div class="highlight"><pre><span></span>$ wc -l *<span class="p">|</span>grep total
    <span class="m">3618</span> total
$ wc -l new/*<span class="p">|</span>grep total
   <span class="m">45573</span> total
</pre></div>


<p>This did not make sense due to small data set:</p>
<div class="highlight"><pre><span></span>$ python similar_tweeters.py Pybonacci
cine_tv_es <span class="m">0</span>.999743 -&gt; nothing to <span class="k">do</span> yet almost <span class="m">1</span>.0 ?!
github <span class="m">0</span>.999743
gvanrossum <span class="m">0</span>.455312
...
</pre></div>


<p>With the new data set, although the script takes longer to run, now the results are much better:</p>
<div class="highlight"><pre><span></span># not much Python: 
$ python similar_tweeters.py paugasol
jsonmez 0.739746
Schwarzenegger 0.739746
tferriss 0.739746
cine_tv_es 0.631373
gvanrossum 0.631373
treyhunner 0.631373
bbelderbos 0.206394
dbader_org 0.206394
newsafaribooks 0.206394
techmoneykids 0.113994
github 0.0983753
lifehacker 0.0983753
pybites 0.056072
importpython 0.0432182
PythonEggs 0.0432182
raymondh 0.0432182

# more Py
$ python similar_tweeters.py pybites
dbader_org 0.936956
importpython 0.936956
PythonEggs 0.936956
tferriss 0.936956 -&gt; not sure about this one
bbelderbos 0.367078
techmoneykids 0.340996
github 0.320053
newsafaribooks 0.320053
gvanrossum 0.138829
jsonmez 0.138829
lifehacker 0.138829
Schwarzenegger 0.138829
treyhunner 0.138829
raymondh 0.0201458
cine_tv_es 0.0
paugasol 0.0

# results change upon second run - comment if you know why / how to fix or improve?
$ python similar_tweeters.py pybites
importpython 0.890289
newsafaribooks 0.890289
PythonEggs 0.890289
bbelderbos 0.506814
techmoneykids 0.443702
jsonmez 0.426503
paugasol 0.426503
Schwarzenegger 0.426503
tferriss 0.426503
github 0.138233
gvanrossum 0.138233
treyhunner 0.138233
dbader_org 0.100782 -&gt; was high last run ?!
lifehacker 0.0658598
raymondh 0.0658598
cine_tv_es 0.0451122
</pre></div>


<p>Running one more, my personal Twitter. Also a lot of Python at the top, jsonmez/ tferriss/ pybites I have mentioned/retweeted more than once. This looks pretty good ...</p>
<div class="highlight"><pre><span></span>$ python similar_tweeters.py bbelderbos
dbader_org <span class="m">0</span>.985021
gvanrossum <span class="m">0</span>.985021
importpython <span class="m">0</span>.985021
jsonmez <span class="m">0</span>.985021
pybites <span class="m">0</span>.985021
PythonEggs <span class="m">0</span>.985021
tferriss <span class="m">0</span>.985021
treyhunner <span class="m">0</span>.985021
techmoneykids <span class="m">0</span>.275167
newsafaribooks <span class="m">0</span>.149423
paugasol <span class="m">0</span>.149423
Schwarzenegger <span class="m">0</span>.149423
raymondh <span class="m">0</span>.142598
cine_tv_es <span class="m">0</span>.064402
github <span class="m">0</span>.064402
lifehacker <span class="m">0</span>.0570781
</pre></div>


</li>
<li>
<p>This was not an easy challenge! However we learned a lot: our first NLP exploration, playing with a relatively complex library and discovering the data science part of it: the quality of your input data.</p>
</li>
</ul>
<h2>Any issues or feedback?</h2>
<p>What did you learn this challenge? Feel free to share you code in the comments below. </p>
<p>How are you experiencing these challenges? You like the format? What can we do differently and/or better?</p>
<h2>next(challenges)</h2>
<p>Next week we pause a bit from Twitter doing something new and original on Monday, stay tuned ...</p>
<p>Again to start coding <a href="https://github.com/pybites/challenges">fork our challenges repo</a> or <a href="https://help.github.com/articles/syncing-a-fork/">sync it</a> if you already forked it.</p>
  </div>

  <h3>&gt;&gt;&gt; next(PyBites)</h3>
<!-- Begin MailChimp Signup Form -->
<div id="mc_embed_signup">
<form action="//pybit.us14.list-manage.com/subscribe/post?u=822043293f280259d4b8d2a3e&amp;id=ac7e2eb9ef" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
    <div id="mc_embed_signup_scroll">
    
<div class="mc-field-group">
    <p>Get our 'Become a Better Python Developer' cheat sheet sent straight to your inbox by signing up for our <a href='http://us14.campaign-archive1.com/home/?u=822043293f280259d4b8d2a3e&id=ac7e2eb9ef'>Newsletter</a>:</p>
    <input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL" placeholder="Email Address">
</div>
    <div id="mce-responses" class="clear">
        <div class="response" id="mce-error-response" style="display:none"></div>
        <div class="response" id="mce-success-response" style="display:none"></div>
    </div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
    <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_822043293f280259d4b8d2a3e_ac7e2eb9ef" tabindex="-1" value=""></div>
    <div class="clear"><input type="submit" value="Join Us" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
    </div>
</form>
</div>
<!--End mc_embed_signup-->
  <div class="tag-cloud">
    <p>
      <a href="http://pybit.es/tag/codechallenges.html">codechallenges</a>
      <a href="http://pybit.es/tag/code-review.html">code review</a>
      <a href="http://pybit.es/tag/learning.html">learning</a>
      <a href="http://pybit.es/tag/nlp.html">nlp</a>
      <a href="http://pybit.es/tag/twitter.html">Twitter</a>
      <a href="http://pybit.es/tag/twitterapi.html">twitterapi</a>
      <a href="http://pybit.es/tag/gensim.html">gensim</a>
      <a href="http://pybit.es/tag/nltk.html">nltk</a>
    </p>
  </div>

  <div class="center social-share">
    <p>    Like this article? Share it with your friends!
</p>
    <div class="addthis_native_toolbox"></div>
    <div class="addthis_sharing_toolbox"></div>
  </div>



<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'http-pybit-es';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>
        Please enable JavaScript to view comments.

</noscript>
</article>

    <footer>
<p>&copy; pybites </p>
<p>    Powered by <a href="http://getpelican.com" target="_blank">Pelican</a> - <a href="https://github.com/alexandrevicenzi/flex" target="_blank">Flex</a> theme by <a href="http://alexandrevicenzi.com" target="_blank">Alexandre Vicenzi</a>
</p>    </footer>
  </main>

<!-- Google Analytics -->
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-89294245-1', 'auto');
  ga('send', 'pageview');
</script>
<!-- End Google Analytics -->

	<script>window.twttr = (function(d, s, id) {
	var js, fjs = d.getElementsByTagName(s)[0],
		t = window.twttr || {};
	if (d.getElementById(id)) return t;
	js = d.createElement(s);
	js.id = id;
	js.src = "https://platform.twitter.com/widgets.js";
	fjs.parentNode.insertBefore(js, fjs);
	t._e = [];
	t.ready = function(f) {
		t._e.push(f);
	};
	return t;
	}(document, "script", "twitter-wjs"));</script>

    <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5859c6a67eb6254d" async="async"></script>


<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " PyBites ",
  "url" : "http://pybit.es",
  "image": "http://pybit.es/theme/img/profile.png",
  "description": "Python Code Challenges, Articles and News - One Bite a Day"
}
</script>
</body>
</html>