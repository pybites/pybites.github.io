<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="Two-phase registration, consisting of initial signup followed by a confirmation/activation email is a common piece for any web app. In this article I will guide you through setting this up in...">
        <meta name="keywords" content="100DaysOfDjango, Django, Django-registration, Gmail, guide, learning, Postgres, registration, SQLite, tutorial, virtualenv">
        <link rel="icon" href="https://pybit.es/favicon.ico">

        <title>A Step by Step Guide to Implementing and Deploying Two-Phase Registration in Django - PyBites</title>

        <!-- Stylesheets -->
        <link href="https://pybit.es/theme/css/all.min.css" rel="stylesheet">
        <!-- /Stylesheets -->

        <!-- RSS Feeds -->
        <link href="https://pybit.es/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="PyBites Full Atom Feed" />
        <link href="https://pybit.es/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="PyBites Full RSS Feed" />
        <link href="https://pybit.es/feeds/django.rss.xml" type="application/rss+xml" rel="alternate" title="PyBites Categories RSS Feed" />
        <!-- /RSS Feeds -->

        <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
          <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
          <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->

          <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5859c6a67eb6254d" async="async"></script>

        <!-- Google Analytics -->
        <script>
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

          ga('create', 'UA-89294245-1', 'auto');
          ga('send', 'pageview');
        </script>
        <!-- /Google Analytics -->



    <!-- Facebook Pixel Code -->
    <script>
      !function(f,b,e,v,n,t,s)
      {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
      n.callMethod.apply(n,arguments):n.queue.push(arguments)};
      if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
      n.queue=[];t=b.createElement(e);t.async=!0;
      t.src=v;s=b.getElementsByTagName(e)[0];
      s.parentNode.insertBefore(t,s)}(window, document,'script',
      'https://connect.facebook.net/en_US/fbevents.js');
      fbq('init', '204929054292880');
      fbq('track', 'PageView');
    </script>
    <noscript><img height="1" width="1" style="display:none"
      src="https://www.facebook.com/tr?id=204929054292880&ev=PageView&noscript=1"
    /></noscript>
    <!-- End Facebook Pixel Code -->

    </head>

    <body>

        <!-- Header -->
    <div class="header-container gradient">

            <!-- Static navbar -->
            <div class="container">
                <div class="header-nav">
                    <div class="header-logo">
                        <a class="pull-left" href="https://pybit.es/"><img class="mr20" src="https://pybit.es/images/logo.png" alt="logo"></a>
                    </div>
                    <div class="nav pull-right">
                                <a  href="https://pybit.es/">Home</a>
                                <a  href="https://pybit.es/archives.html">Blog</a>
                                <a href="https://codechalleng.es" target="_blank">Platform</a>
                                <a  style="background-color: #ba9926!important; border-radius: 5px;" href="https://pybit.es/pages/apply.html">Apply</a>
                    </div>
                </div>
            </div>
            <!-- /Static navbar -->

            <!-- Header -->
    <!-- Header -->
    <div class="container header-wrapper">
        <div class="row">
              <div class="col-lg-12">
                  <div class="header-content">
                      <h1 class="header-title">A Step by Step Guide to Implementing and Deploying Two-Phase Registration in Django</h1>
                      <p class="header-date"> <a href="https://pybit.es/author/bob.html">Bob</a>, Sat 05 August 2017,  <a href="https://pybit.es/category/django.html">Django</a></p>
                      <div class="header-underline"></div>
                      <div class="clearfix"></div>
                      <p class="pull-right header-tags">
                          <span class="glyphicon glyphicon-tags mr5" aria-hidden="true"></span>
<a href="https://pybit.es/tag/100daysofdjango.html">100DaysOfDjango</a>, <a href="https://pybit.es/tag/django.html">Django</a>, <a href="https://pybit.es/tag/django-registration.html">Django-registration</a>, <a href="https://pybit.es/tag/gmail.html">Gmail</a>, <a href="https://pybit.es/tag/guide.html">guide</a>, <a href="https://pybit.es/tag/learning.html">learning</a>, <a href="https://pybit.es/tag/postgres.html">Postgres</a>, <a href="https://pybit.es/tag/registration.html">registration</a>, <a href="https://pybit.es/tag/sqlite.html">SQLite</a>, <a href="https://pybit.es/tag/tutorial.html">tutorial</a>, <a href="https://pybit.es/tag/virtualenv.html">virtualenv</a>                      </p>
                  </div>
              </div>
        </div>
    </div>
    <!-- /Header -->
            <!-- /Header -->

        </div>
        <!-- /Header -->


        <!-- Content -->
    <div class="container content">
        <p>Two-phase registration, consisting of initial signup followed by a confirmation/activation email is a common piece for any web app. In this article I will guide you through setting this up in Django using the <a href="https://django-registration.readthedocs.io/en/2.2/">Django-registration plugin</a> and Gmail for messaging. Then I show you how to deploy the app to Heroku.</p>
<p>I built the first iteration for <a href="https://pybit.es/codechallenge29_review.html">Code Challenge 29 - Create a Simple Django App</a>:</p>
<blockquote>
<p>I created a Django registration / login system using django-registration and gmail. ... What's cool about it is that I can re-use this code for other new projects where this functionality is often required. I will do an article this week detailing some of the challenges I had to get this working ...</p>
</blockquote>
<p>Well, here we go ...</p>
<h2>The plan</h2>
<p>This serves as the tutorial I wanted to have when I got started. You will probably save time too, because I ran into various issues which I ironed out in the steps below.</p>
<p>An earlier iteration is <a href="https://github.com/pybites/django-registration">on Github</a>, but I will build it again from scratch so we can see it step-by-step and Julian can test it out for himself (thanks buddy!)</p>
<h2>Getting ready</h2>
<p>First we create a virtual env and install Django, <a href="https://django-registration.readthedocs.io/en/2.2/index.html">Django-registration</a> and the other plugins we will use. If you want to use SQLite you can leave psycopg2 out. If you want to follow along now is a good time to fire up your terminal!</p>
<div class="highlight"><pre><span></span>$ mkdir registration <span class="o">&amp;&amp;</span> <span class="nb">cd</span> <span class="nv">$_</span>
$ python3 -m venv venv <span class="o">&amp;&amp;</span> <span class="nb">source</span> venv/bin/activate
<span class="o">(</span>venv<span class="o">)</span> $ pip install django django-registration dj-database-url gunicorn psycopg2
...

<span class="o">(</span>venv<span class="o">)</span> $ pip freeze
dj-database-url<span class="o">==</span><span class="m">0</span>.4.2
<span class="nv">Django</span><span class="o">==</span><span class="m">1</span>.11.4
django-registration<span class="o">==</span><span class="m">2</span>.2
<span class="nv">gunicorn</span><span class="o">==</span><span class="m">19</span>.7.1
<span class="nv">psycopg2</span><span class="o">==</span><span class="m">2</span>.7.3
<span class="nv">pytz</span><span class="o">==</span><span class="m">2017</span>.2
</pre></div>


<p>Let's create our Django project</p>
<div class="highlight"><pre><span></span>(venv) $ django-admin.py startproject register
# (cannot use dir name &#39;registration&#39;)
</pre></div>


<p>When I talk about project toplevel or root dir I mean this outer register directory. It's where <code>manage.py</code> lives:</p>
<div class="highlight"><pre><span></span>(venv) $ ls register/
manage.py    register
</pre></div>


<p>If I talk about the main app I mean this directory:</p>
<div class="highlight"><pre><span></span>(venv) $ ls register/register/
__init__.py    settings.py    urls.py        wsgi.py
</pre></div>


<p>It's where Django's config or <code>settings.py</code> lives and it's the main app we use to set up main view, urls and template. There won't be much coding though because Django-registration abstracts a lot away for us. Most effort will go into setup and configuration.</p>
<blockquote>
<p>By the way, the Django directory / file structure can be quite confusing when you are getting started. Maybe good to wrap this in another short article and/or touch upon it when we'll look at Cookiecutter Django ...</p>
</blockquote>
<h2>Sanity check</h2>
<p>You should be able to run Django now:</p>
<div class="highlight"><pre><span></span>$ <span class="nb">cd</span> register
$ python manage.py runserver
</pre></div>


<p>Navigate to <code>http://127.0.0.1:8000/</code> - you should see Django's <em>It worked!</em> page. It also says <em>You have 13 unapplied migration(s).</em> - we get to that later in the Migration section.</p>
<p>If you want to use Postgres like me now is a good time to create the database. If you want to use SQLite you can skip this step.</p>
<div class="highlight"><pre><span></span>(venv) $ psql
bbelderb=# create database notifications;
bbelderb=# \c notifications
You are now connected to database &quot;notifications&quot; as user &quot;bbelderb&quot;.
</pre></div>


<p>We call it notifications because </p>
<h2>Messaging</h2>
<p>I will use Gmail here but you could also use a service like Heroku's <a href="https://devcenter.heroku.com/articles/sendgrid">SendGrid</a>. This is probably better in the long run because to have Gmail working on Heroku you have to relinquish security:</p>
<ol>
<li>
<p>you have to enable <a href="https://www.google.com/settings/security/lesssecureapps">this setting</a> to allow emailing from someplace other than gmail;</p>
</li>
<li>
<p>that worked for localhost, for Heroku though I had to <a href="http://www.google.com/accounts/DisplayUnlockCaptcha">DisplayUnlockCaptcha</a> when I started mailing (testing first signup). See <a href="https://stackoverflow.com/questions/18124878/netsmtpauthenticationerror-when-sending-email-from-rails-app-on-staging-envir">here</a> for more information.</p>
</li>
</ol>
<p>So I recommend you create a separate gmail account if you go this route.</p>
<h2>Environment variables</h2>
<p>We need some env variables. I set those in this virtual env so they are bound to this app (Zen: <em>namespaces are a honking great idea</em>, right?):</p>
<p>At the end of <em>venv/bin/activate</em>:</p>
<div class="highlight"><pre><span></span>export SECRET_KEY=some_large_random_string  -&gt; get it from Django&#39;s settings.py or generate one yourself
export DJANGO_ENV=&#39;local&#39;
export GMAIL_SMTP_USER=&#39;new_gmail_account&#39;
export GMAIL_SMTP_PASSWORD=&#39;gmail_pw_of_this_account&#39;
export DB_NAME=&#39;notifications&#39;
export DB_USER=&#39;pbcl&#39;
export DB_PW=&#39;your_password&#39;
</pre></div>


<p>If you want to use SQLite you can omit the <code>DB_*</code> variables.</p>
<p>Make sure you re-activate your venv so these variables become active:</p>
<div class="highlight"><pre><span></span>(venv) $ deactivate
$ source venv/bin/activate
</pre></div>


<p>Last command is convenient to have in your .bashrc (assuming you always have your virtual env in your project folder naming it <em>venv</em>):</p>
<div class="highlight"><pre><span></span>alias ae=&#39;source venv/bin/activate&#39;
</pre></div>


<h2>Configuring Django</h2>
<p>Let's set up Django's configuration that lives at <code>register/register/settings.py</code> (from venv dir). Some of this is early encapsulation and required/recommended config for later deployment to Heroku. Please bare with me.</p>
<ol>
<li>
<p>Locate the <code>SECRET_KEY</code> variable, delete it and add your own, also let Django know in what environment we are:</p>
<div class="highlight"><pre><span></span>SECRET_KEY = os.getenv(&#39;SECRET_KEY&#39;)
DJANGO_ENV = os.getenv(&#39;DJANGO_ENV&#39;, &#39;production&#39;).lower()
</pre></div>


</li>
<li>
<p>Now using the newly Django env variable let's delete the <code>DEBUG</code> variable and set it based on env with the snippet below. We will use Heroku later to deploy the app so let's add that to <code>ALLOWED_HOSTS</code> (and limit the catch-all <code>*</code> to local env only):</p>
<div class="highlight"><pre><span></span>if DJANGO_ENV == &#39;local&#39;:
    DEBUG = True
    ALLOWED_HOSTS = [&#39;*&#39;]
else:
    DEBUG = False
    ALLOWED_HOSTS = [&#39;.herokuapp.com&#39;]
</pre></div>


<p>Making these two changes addresses the two 'SECURITY WARNING' comments in <code>settings.py</code>.</p>
</li>
<li>
<p>Using the django-registration no additions are needed to <code>INSTALLED_APPS</code> and <code>MIDDLEWARE</code>, that all works out-of-the-box with Django-registration.</p>
</li>
<li>
<p>Templates directories: update the DIRS list in <code>TEMPLATES</code> so Django knows where to look for templates:</p>
<div class="highlight"><pre><span></span>...
TEMPLATES = [
    ...
    &#39;DIRS&#39;: [
        os.path.join(BASE_DIR, &#39;templates&#39;),
        os.path.join(BASE_DIR, &#39;register&#39;, &#39;templates&#39;),
  ],
...
</pre></div>


<p>We will create the actual directories on the file system when we're done with <code>settings.py</code>.</p>
</li>
<li>
<p>Database config: we load in the env variables for our local use. For production (Heroku) we use <code>dj_database_url</code>. This is for A. Postgres, for SQLite use B.:</p>
<p>A. Postgres</p>
<div class="highlight"><pre><span></span><span class="n">DATABASES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;ENGINE&#39;</span><span class="p">:</span> <span class="s1">&#39;django.db.backends.postgresql_psycopg2&#39;</span><span class="p">,</span>
        <span class="s1">&#39;NAME&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;DB_NAME&#39;</span><span class="p">),</span>
        <span class="s1">&#39;USER&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;DB_USER&#39;</span><span class="p">),</span>
        <span class="s1">&#39;PASSWORD&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;DB_PW&#39;</span><span class="p">),</span>
        <span class="s1">&#39;HOST&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;DB_HOST&#39;</span><span class="p">,</span> <span class="s1">&#39;localhost&#39;</span><span class="p">),</span>
        <span class="s1">&#39;PORT&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;DB_PORT&#39;</span><span class="p">,</span> <span class="s1">&#39;5432&#39;</span><span class="p">),</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">if</span> <span class="n">DJANGO_ENV</span> <span class="o">==</span> <span class="s1">&#39;production&#39;</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">dj_database_url</span>
    <span class="n">db_from_env</span> <span class="o">=</span> <span class="n">dj_database_url</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">conn_max_age</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
    <span class="n">DATABASES</span><span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">db_from_env</span><span class="p">)</span>
</pre></div>


<p>B. SQLite = default setting changing the name of the DB:</p>
<div class="highlight"><pre><span></span>DATABASES = {
    &#39;default&#39;: {
        &#39;ENGINE&#39;: &#39;django.db.backends.sqlite3&#39;,
        &#39;NAME&#39;: os.path.join(BASE_DIR, &#39;notifications.sqlite3&#39;),
    }
}
</pre></div>


</li>
<li>
<p>Static files are still confusing at times for me but this is <a href="https://devcenter.heroku.com/articles/django-assets">the recommended setting for Heroku</a> that worked for me. Put it at the end of <code>settings.py</code>:</p>
<div class="highlight"><pre><span></span>PROJECT_ROOT = os.path.dirname(os.path.abspath(__file__))

STATIC_ROOT = os.path.join(PROJECT_ROOT, &#39;staticfiles&#39;)
STATIC_URL = &#39;/static/&#39;

# Extra places for collectstatic to find static files.
STATICFILES_DIRS = (
    os.path.join(PROJECT_ROOT, &#39;static&#39;),
)
</pre></div>


<p>Three more settings to go ...</p>
</li>
<li>
<p>Add the Django-registration setting to limit activation of accounts from the validation email to 7 days:</p>
<div class="highlight"><pre><span></span>ACCOUNT_ACTIVATION_DAYS = 7
</pre></div>


</li>
<li>
<p>Set the email config, assuming you're using Gmail like me:</p>
<div class="highlight"><pre><span></span>EMAIL_HOST = &#39;smtp.gmail.com&#39;
EMAIL_PORT = 587
EMAIL_USE_TLS = True
EMAIL_HOST_USER = os.getenv(&#39;GMAIL_SMTP_USER&#39;)
EMAIL_HOST_PASSWORD = os.getenv(&#39;GMAIL_SMTP_PASSWORD&#39;)
</pre></div>


<p>Note we need port 587 for gmail, see <a href="https://stackoverflow.com/questions/2894802/send-activate-email-with-django-registration">here</a>.</p>
</li>
<li>
<p>And lastly with <code>DEBUG</code> set to False in Production (Heroku), if anything blows up we only see a useless 500 error. I <a href="https://chrxr.com/django-error-logging-configuration-heroku/">found this setting</a> which sends errors to Heroku's log. You can then easily debug anything pulling the remote logs with Heroku CLI's <code>heroku log</code> command. Add this snippet to <code>settings.py</code>:</p>
<div class="highlight"><pre><span></span>LOGGING = {
    &#39;version&#39;: 1,
    &#39;disable_existing_loggers&#39;: False,
    &#39;handlers&#39;: {
        &#39;console&#39;: {
            &#39;class&#39;: &#39;logging.StreamHandler&#39;,
        },
    },
    &#39;loggers&#39;: {
        &#39;django&#39;: {
            &#39;handlers&#39;: [&#39;console&#39;],
            &#39;level&#39;: os.getenv(&#39;DJANGO_LOG_LEVEL&#39;, &#39;ERROR&#39;),
        },
    },
}
</pre></div>


</li>
</ol>
<p>If you're lost at this point the complete settings file is <a href="https://github.com/pybites/django-registration/blob/master/register/settings.py">here</a>.</p>
<p>Remember that we updated <code>TEMPLATES</code> settings under 4.? Let's create these directories. They will hold static and template files.</p>
<div class="highlight"><pre><span></span># just to make sure:
(venv) $ pwd
./registration/register

(venv) $ mkdir templates
(venv) $ mkdir register/templates
(venv) $ mkdir register/static
</pre></div>


<p>I am making two templates directories to use template inheritance: the upper templates dir will host a base.html we will extend from and the templates associated with the Django-registration plugin we will download in a bit.</p>
<h2>DB migration</h2>
<p>As we saw before when we started Django's webserver the data was not yet loaded in. Let's do that now:</p>
<div class="highlight"><pre><span></span>$ python manage.py migrate
Operations to perform:
    Apply all migrations: admin, auth, contenttypes, sessions
...
</pre></div>


<p>Let's also create a superuser to be able to manage users that sign up:</p>
<div class="highlight"><pre><span></span>$ python manage.py createsuperuser
...
</pre></div>


<h2>Base template and static files</h2>
<p>Create a <code>base.html</code> inside ./registration/register/templates/ with the following content:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;utf-8&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>PyBites Django-registration Tutorial<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
        <span class="cp">{%</span> <span class="k">load</span> <span class="nv">static</span> <span class="cp">%}</span>
        <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">link</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;https://fonts.googleapis.com/css?family=Open+Sans&quot;</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/css&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{%</span> <span class="k">static</span> <span class="s1">&#39;style.css&#39;</span> <span class="cp">%}</span><span class="s">&quot;</span> <span class="p">/&gt;</span>
    <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">header</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span><span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;login&quot;</span><span class="p">&gt;</span>
            <span class="cp">{%</span> <span class="k">if</span> <span class="nv">user.is_authenticated</span> <span class="cp">%}</span>
                Hey <span class="cp">{{</span> <span class="nv">user.username</span> <span class="cp">}}</span>, <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;auth_logout&#39;</span> <span class="cp">%}</span><span class="s">?next=/&quot;</span><span class="p">&gt;</span>logout<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
            <span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
                Hello guest,  <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;auth_login&#39;</span> <span class="cp">%}</span><span class="s">&quot;</span><span class="p">&gt;</span>login (register)<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
            <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">header</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">main</span><span class="p">&gt;</span>
        <span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
        <span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
    <span class="p">&lt;/</span><span class="nt">main</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>


<p>If you want to add your own CSS styles on top of Purecss create a <code>style.css</code> inside the register/static/ folder.</p>
<p>Here is a bare minimum to use Google fonts and align the login div:</p>
<div class="highlight"><pre><span></span><span class="o">(</span><span class="nt">venv</span><span class="o">)</span> <span class="o">$</span> <span class="nt">cat</span> <span class="nt">register</span><span class="o">/</span><span class="nt">register</span><span class="o">/</span><span class="nt">static</span><span class="o">/</span><span class="nt">style</span><span class="p">.</span><span class="nc">css</span>
<span class="nt">body</span> <span class="p">{</span>
    <span class="k">background-color</span><span class="p">:</span> <span class="mh">#fff</span><span class="p">;</span>
    <span class="k">width</span><span class="p">:</span> <span class="mi">800</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">margin</span><span class="p">:</span> <span class="mi">0</span> <span class="kc">auto</span><span class="p">;</span>
    <span class="k">font-family</span><span class="p">:</span> <span class="s1">&#39;Open Sans&#39;</span><span class="p">,</span> <span class="kc">sans-serif</span><span class="p">;</span>
<span class="p">}</span>
<span class="nt">form</span> <span class="p">{</span>
    <span class="k">margin</span><span class="p">:</span> <span class="mi">20</span><span class="kt">px</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">#</span><span class="nn">login</span> <span class="p">{</span>
    <span class="k">border-bottom</span><span class="p">:</span> <span class="mi">1</span><span class="kt">px</span> <span class="kc">solid</span> <span class="mh">#ddd</span><span class="p">;</span>
    <span class="k">padding-bottom</span><span class="p">:</span> <span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">margin-bottom</span><span class="p">:</span> <span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">text-align</span><span class="p">:</span> <span class="kc">right</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<h2>Django-registration templates</h2>
<p>Unfortunately the required templates are not included in Django-registration when pip installing it. What I ended up doing was grabbing them from <a href="https://github.com/macdhuibh/django-registration-templates">django-registration-templates</a>. However I made some wording and styling (<a href="https://purecss.io">purecss</a>) changes to them and one template - <em>password_reset_email.txt</em> - was missing from that set, which caused the password reset page to crash. So grab my copy instead:</p>
<div class="highlight"><pre><span></span># you should be here:
(venv) $ pwd
./registration/register

# grab them from the GH repo in case I make further changes:
(venv) $ git clone https://github.com/pybites/django-registration ~/Downloads/registration-templates
...

(venv) $ cp -r  ~/Downloads/registration-templates/templates/registration templates/
(venv) $ ls templates/
base.html    registration
</pre></div>


<h2>Write some Django code</h2>
<p>OK with all this setup in place (sorry) let's actually write some code. The good news is that Django-registration requires very little of it.</p>
<h2>URL routing</h2>
<p>cd into the main app (./registration/register/register):</p>
<div class="highlight"><pre><span></span>(venv) $ cd register/
</pre></div>


<p>Replace the content of <code>urls.py</code> with the following code:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">url</span><span class="p">,</span> <span class="n">include</span>
<span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>
<span class="kn">from</span> <span class="nn">django.views.static</span> <span class="kn">import</span> <span class="n">serve</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^admin/&#39;</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^accounts/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s1">&#39;registration.backends.hmac.urls&#39;</span><span class="p">)),</span>
<span class="p">]</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">settings</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
    <span class="n">urlpatterns</span> <span class="o">+=</span> <span class="p">[</span>
        <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^static/(?P&lt;path&gt;.*)$&#39;</span><span class="p">,</span> <span class="n">serve</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">&#39;document_root&#39;</span><span class="p">:</span> <span class="n">settings</span><span class="o">.</span><span class="n">STATIC_ROOT</span><span class="p">,</span>
        <span class="p">}),</span>
    <span class="p">]</span>
</pre></div>


<p>The accounts regex entry is required for the Django-registration plugin (we're using the recommended <a href="https://django-registration.readthedocs.io/en/2.2/hmac.html#hmac-workflow">two-phase or hmac-workflow</a>). The admin route is to manage the signed up users via Django's builtin admin.</p>
<p>I needed the last <code>if not</code> block to get static files working on Heroku, see <a href="https://docs.djangoproject.com/en/1.11/ref/views/#django.views.static.serve">here</a> and <a href="https://matthewphiong.com/managing-django-static-files-on-heroku">here</a>.</p>
<p>Next time I probably consider using a service like <a href="https://devcenter.heroku.com/articles/django-assets#whitenoise">Whitenoise</a> which should make this easier.</p>
<h3>Homepage</h3>
<p>Let's add a simple index view to greet the guest or logged in user and provide a link to sign up. Still in the register/ main app, create a file called <code>views.py</code> and add the following code:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span>
<span class="kn">from</span> <span class="nn">django.template</span> <span class="kn">import</span> <span class="n">loader</span>

<span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">template</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">get_template</span><span class="p">(</span><span class="s1">&#39;index.html&#39;</span><span class="p">)</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">template</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">request</span><span class="p">))</span>
</pre></div>


<p>It points to an HTML template called <code>index.html</code>. Let's create this next. Still inside the inner <em>register</em> app folder, create this file inside register/templates/:</p>
<div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s1">&#39;base.html&#39;</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">if</span> <span class="nv">user.is_authenticated</span> <span class="cp">%}</span>
    <span class="nt">&lt;p&gt;&lt;strong&gt;</span>Dear <span class="cp">{{</span> <span class="nv">user.username</span> <span class="cp">}}</span>, glad to have you here!<span class="nt">&lt;/strong&gt;&lt;/p&gt;</span>
    <span class="nt">&lt;p&gt;</span>You will receive an email for each new PyBites Code Challenge.<span class="nt">&lt;/p&gt;</span>
    <span class="nt">&lt;p&gt;</span>We will tweak this page to include more notification settings ...<span class="nt">&lt;/p&gt;</span>
<span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
    <span class="nt">&lt;p&gt;</span>You can <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;registration_register&#39;</span> <span class="cp">%}</span><span class="s">&quot;</span><span class="nt">&gt;</span>sign up here<span class="nt">&lt;/a&gt;</span> to get a notification email for each new challenge<span class="nt">&lt;/p&gt;</span>
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>


<p>Here we extend the base.html template in the root templates folder. The <code>TEMPLATES</code> -&gt; <code>DIR</code> list we updated earlier in <code>settings.py</code> makes this magically work. We check if the user is authenticated and message/link accordingly.</p>
<p>Let's collect static files into <code>STATIC_ROOT</code> using <a href="https://docs.djangoproject.com/en/1.11/ref/contrib/staticfiles/#collectstatic">collectstatic</a>:</p>
<div class="highlight"><pre><span></span>(venv) $ cd ..
(venv) $ python manage.py collectstatic
</pre></div>


<p>And run the app:</p>
<div class="highlight"><pre><span></span>(venv) $ python manage.py runserver
</pre></div>


<p>You should see this:</p>
<p><img alt="runserver app index template" src="https://pybit.es/images/django-reg-helloworld.png"></p>
<p>Click on the <em>sign up here</em> link, you should see a sign up form. One thing that does not seem right is the validation messages being visible all the time. I will fix and post here ...</p>
<p><img alt="sign up form" src="https://pybit.es/images/django-reg-reg-form.png"></p>
<p>Enter your username, email and password and click Submit:</p>
<p><img alt="register, email will be send" src="https://pybit.es/images/django-reg-reg-link-follow.png"></p>
<p>If all is setup correctly (env vars, gmail prep) You should get an email:</p>
<p><img alt="confirmation link" src="https://pybit.es/images/django-reg-email.png"></p>
<p>Click on the link and your account should be activated:</p>
<p><img alt="runserver app index template" src="https://pybit.es/images/django-reg-reg-link-follow.png"></p>
<p>You can now login and you should see the logged in page:</p>
<p><img alt="registed and activated account" src="https://pybit.es/images/django-reg-registered-and-activated.png"></p>
<p>TODO: have the user be logged automatically upon activation of account.</p>
<h2>Commit to version control</h2>
<p>Normally I would be make granular commits as we go but I wanted to focus on Django.</p>
<p>First of all init a repo - inside the register/ root folder (where <code>manage.py</code> lives):</p>
<div class="highlight"><pre><span></span>(venv) $ git init
</pre></div>


<p>Make sure we don't commit irrelevant files by adding a <code>.gitignore</code> file with the following content:</p>
<div class="highlight"><pre><span></span>(venv) $ cat .gitignore
**pyc
**swp
**__pycache__
register/staticfiles/
*sqlite3
</pre></div>


<p>(last line is if you use a SQLite DB)</p>
<div class="highlight"><pre><span></span>(venv) $ git add .
(venv) $ git commit -m &quot;init commit&quot;
</pre></div>


<h2>Deploy to Heroku</h2>
<p>Now let's get our shiny app to the cloud. After all we did a lot of config in advance so it should be pretty easy now:</p>
<h3>Heroku login</h3>
<p>Install <a href="https://devcenter.heroku.com/articles/heroku-cli">Heroku CLI</a> and login.</p>
<div class="highlight"><pre><span></span>(venv) $ heroku login
</pre></div>


<p>Make sure you are in register/ where <code>manage.py</code> lives. This is important because I had issues where I had Heroku look for <code>wsgi.py</code> under register/register and it would not work. So make sure you get this:</p>
<div class="highlight"><pre><span></span>(venv) $ ls register/wsgi.py
register/wsgi.py
</pre></div>


<p>Add the following required files:</p>
<div class="highlight"><pre><span></span>(venv) $ echo &quot;python-3.6.2&quot; &gt; runtime.txt
</pre></div>


<p>Nice, Heroku uses Python 3.6!</p>
<div class="highlight"><pre><span></span>(venv) $ echo  &quot;release: python manage.py migrate&quot; &gt; Procfile
(venv) $ echo &quot;web: gunicorn register.wsgi:application --log-file -&quot; &gt;&gt; Procfile
</pre></div>


<p>The first line is not required but adds migration as extra step to each Heroku build, useful.</p>
<p>And finally let Heroku know what dependencies we need:</p>
<div class="highlight"><pre><span></span>(venv) $ pip freeze &gt; requirements.txt
</pre></div>


<p>Commit these 3 files:</p>
<div class="highlight"><pre><span></span>(venv) $ git add .
(venv) $ git commit -m &quot;added heroku config files&quot;
</pre></div>


<p>You can test the site locally. If doing so store your env variables in <code>.env</code> (and make sure to exclude that file from version control!)</p>
<div class="highlight"><pre><span></span>(venv) $ heroku local web
</pre></div>


<p>Crreate the app with a unique enough name:</p>
<div class="highlight"><pre><span></span>(venv) $ heroku apps:create bobregistration
Creating ⬢ bobregistration... done
https://bobregistration.herokuapp.com/ | https://git.heroku.com/bobregistration.git
</pre></div>


<p>The git remote should be added automatically, if not run:</p>
<div class="highlight"><pre><span></span>(venv) $ git remote add heroku https://git.heroku.com/bobregistration.git

(venv) $ git remote -v
heroku    https://git.heroku.com/bobregistration.git (fetch)
heroku    https://git.heroku.com/bobregistration.git (push)
</pre></div>


<p>If you want to use a Postgres DB provision it now, see <a href="https://devcenter.heroku.com/articles/heroku-postgresql">here</a>:</p>
<div class="highlight"><pre><span></span>(venv) $ heroku addons:create heroku-postgresql:hobby-dev
</pre></div>


<p>Heroku automatically sets the <code>DATABASE_URL</code> env variable for you. The <code>dj_database_url</code> plugin we pip installed and configured in <code>settings.py</code> takes care of the rest. This makes the <code>DB_ *</code> variables only for local use. You can see your Heroku databases <a href="https://data.heroku.com/">here</a>.</p>
<p>Finally let's set the other env variables via Heroku CLI:</p>
<div class="highlight"><pre><span></span>(venv) $ heroku config:set SECRET_KEY=&#39;some_large_random_string&#39;
(venv) $ heroku config:set DJANGO_ENV=&#39;production&#39;
(venv) $ heroku config:set GMAIL_SMTP_USER=&#39;new_gmail_account&#39;
(venv) $ heroku config:set GMAIL_SMTP_PASSWORD=&#39;gmail_pw_of_this_account&#39;
</pre></div>


<p>With all this in place deploying to Heroku is very easy: just <code>git push</code> - awesome!</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="n">venv</span><span class="p">)</span> <span class="err">$</span> <span class="n">git</span> <span class="n">push</span> <span class="n">heroku</span> <span class="n">master</span>
<span class="n">Counting</span> <span class="nl">objects</span><span class="p">:</span> <span class="mi">45</span><span class="p">,</span> <span class="n">done</span><span class="p">.</span>
<span class="n">Delta</span> <span class="n">compression</span> <span class="n">using</span> <span class="n">up</span> <span class="n">to</span> <span class="mi">4</span> <span class="n">threads</span><span class="p">.</span>
<span class="n">Compressing</span> <span class="nl">objects</span><span class="p">:</span> <span class="mi">100</span><span class="o">%</span> <span class="p">(</span><span class="mi">42</span><span class="o">/</span><span class="mi">42</span><span class="p">),</span> <span class="n">done</span><span class="p">.</span>
<span class="n">Writing</span> <span class="nl">objects</span><span class="p">:</span> <span class="mi">100</span><span class="o">%</span> <span class="p">(</span><span class="mi">45</span><span class="o">/</span><span class="mi">45</span><span class="p">),</span> <span class="mf">16.95</span> <span class="n">KiB</span> <span class="o">|</span> <span class="mi">0</span> <span class="n">bytes</span><span class="o">/</span><span class="n">s</span><span class="p">,</span> <span class="n">done</span><span class="p">.</span>
<span class="n">Total</span> <span class="mi">45</span> <span class="p">(</span><span class="n">delta</span> <span class="mi">7</span><span class="p">),</span> <span class="n">reused</span> <span class="mi">0</span> <span class="p">(</span><span class="n">delta</span> <span class="mi">0</span><span class="p">)</span>
<span class="nl">remote</span><span class="p">:</span> <span class="n">Compressing</span> <span class="n">source</span> <span class="n">files</span><span class="p">...</span> <span class="n">done</span><span class="p">.</span>
<span class="nl">remote</span><span class="p">:</span> <span class="n">Building</span> <span class="nl">source</span><span class="p">:</span>
<span class="nl">remote</span><span class="p">:</span>
<span class="nl">remote</span><span class="p">:</span> <span class="o">-----&gt;</span> <span class="n">Python</span> <span class="n">app</span> <span class="n">detected</span>
<span class="nl">remote</span><span class="p">:</span> <span class="o">-----&gt;</span> <span class="n">Installing</span> <span class="n">python</span><span class="o">-</span><span class="mf">3.6.2</span>
<span class="nl">remote</span><span class="p">:</span> <span class="o">-----&gt;</span> <span class="n">Installing</span> <span class="n">pip</span>
<span class="nl">remote</span><span class="p">:</span> <span class="o">-----&gt;</span> <span class="n">Installing</span> <span class="n">requirements</span> <span class="n">with</span> <span class="n">pip</span>
<span class="p">....</span>
<span class="nl">remote</span><span class="p">:</span>        <span class="n">Successfully</span> <span class="n">installed</span> <span class="n">Django</span><span class="o">-</span><span class="mf">1.11.4</span> <span class="n">dj</span><span class="o">-</span><span class="n">database</span><span class="o">-</span><span class="n">url</span><span class="o">-</span><span class="mf">0.4.2</span> <span class="n">django</span><span class="o">-</span><span class="n">registration</span><span class="o">-</span><span class="mf">2.2</span> <span class="n">gunicorn</span><span class="o">-</span><span class="mf">19.7.1</span> <span class="n">psycopg2</span><span class="o">-</span><span class="mf">2.7.3</span> <span class="n">pytz</span><span class="o">-</span><span class="mf">2017.2</span>
<span class="nl">remote</span><span class="p">:</span>
<span class="nl">remote</span><span class="p">:</span> <span class="o">-----&gt;</span> <span class="err">$</span> <span class="n">python</span> <span class="n">manage</span><span class="p">.</span><span class="n">py</span> <span class="n">collectstatic</span> <span class="o">--</span><span class="n">noinput</span>
<span class="nl">remote</span><span class="p">:</span>        <span class="mi">66</span> <span class="k">static</span> <span class="n">files</span> <span class="n">copied</span> <span class="n">to</span> <span class="err">&#39;</span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">build_1f0fe577269a9c44ab8bdaa75f241a79</span><span class="o">/</span><span class="k">register</span><span class="o">/</span><span class="n">staticfiles</span><span class="err">&#39;</span><span class="p">.</span>
<span class="nl">remote</span><span class="p">:</span>
<span class="nl">remote</span><span class="p">:</span> <span class="o">-----&gt;</span> <span class="n">Discovering</span> <span class="n">process</span> <span class="n">types</span>
<span class="nl">remote</span><span class="p">:</span>        <span class="n">Procfile</span> <span class="n">declares</span> <span class="n">types</span> <span class="o">-&gt;</span> <span class="k">release</span><span class="p">,</span> <span class="n">web</span>
<span class="nl">remote</span><span class="p">:</span>
<span class="nl">remote</span><span class="p">:</span> <span class="o">-----&gt;</span> <span class="n">Compressing</span><span class="p">...</span>
<span class="nl">remote</span><span class="p">:</span>        <span class="nl">Done</span><span class="p">:</span> <span class="mf">50.6</span><span class="n">M</span>
<span class="nl">remote</span><span class="p">:</span> <span class="o">-----&gt;</span> <span class="n">Launching</span><span class="p">...</span>
<span class="nl">remote</span><span class="p">:</span>  <span class="o">!</span>     <span class="n">Release</span> <span class="n">command</span> <span class="nl">declared</span><span class="p">:</span> <span class="n">this</span> <span class="n">new</span> <span class="k">release</span> <span class="n">will</span> <span class="n">not</span> <span class="n">be</span> <span class="n">available</span> <span class="n">until</span> <span class="n">the</span> <span class="n">command</span> <span class="n">succeeds</span><span class="p">.</span>
<span class="nl">remote</span><span class="p">:</span>        <span class="n">Released</span> <span class="n">v9</span>
<span class="nl">remote</span><span class="p">:</span>        <span class="nl">https</span><span class="p">:</span><span class="c1">//bobregistration.herokuapp.com/ deployed to Heroku</span>
<span class="nl">remote</span><span class="p">:</span>
<span class="nl">remote</span><span class="p">:</span> <span class="n">Verifying</span> <span class="n">deploy</span><span class="p">...</span> <span class="n">done</span><span class="p">.</span>
<span class="nl">remote</span><span class="p">:</span> <span class="n">Running</span> <span class="k">release</span> <span class="n">command</span><span class="p">...</span>
<span class="nl">remote</span><span class="p">:</span>
<span class="nl">remote</span><span class="p">:</span> <span class="n">Operations</span> <span class="n">to</span> <span class="nl">perform</span><span class="p">:</span>
<span class="nl">remote</span><span class="p">:</span>   <span class="n">Apply</span> <span class="n">all</span> <span class="nl">migrations</span><span class="p">:</span> <span class="n">admin</span><span class="p">,</span> <span class="n">auth</span><span class="p">,</span> <span class="n">contenttypes</span><span class="p">,</span> <span class="n">sessions</span>
<span class="nl">remote</span><span class="p">:</span> <span class="n">Running</span> <span class="nl">migrations</span><span class="p">:</span>
<span class="p">...</span>
<span class="nl">remote</span><span class="p">:</span> <span class="n">Waiting</span> <span class="k">for</span> <span class="k">release</span><span class="p">....</span> <span class="n">done</span><span class="p">.</span>
<span class="n">To</span> <span class="nl">https</span><span class="p">:</span><span class="c1">//git.heroku.com/bobregistration.git</span>
<span class="o">*</span> <span class="p">[</span><span class="n">new</span> <span class="n">branch</span><span class="p">]</span>      <span class="n">master</span> <span class="o">-&gt;</span> <span class="n">master</span>
</pre></div>


<p>And voilà: the app now runs in the cloud. I will delete it after this tutorial, check out <a href="http://pybites-notifier.herokuapp.com/">this version</a> if you want to try it or subscribe to weekly PyBites Code Challenge notifications. Or better yet: host your own!</p>
<p>To add the superuser to the remote DB you can use Heroku's shell:</p>
<div class="highlight"><pre><span></span>(venv) $ heroku run python manage.py createsuperuser
...
</pre></div>


<h2>In Closing</h2>
<p>Wow, this was a lot to absorb but I wanted to get it out there. Although Django-registration makes it very easy to get two-phase registration going, getting to an end-to-end solution required some effort. Sorting out registration and authentication though is a major part of any modern app so I am glad we got this one down. It's also easy to copy this project and build the other pieces around it. </p>
<p>I hope you found this tutorial useful. If you have any feedback or inputs use the comments below.</p>
<p>Julian (aka Flask addict), you have to give it to Django (plugins) that this is pretty slick stuff, no? I hope you learned a bite of Django too.</p>
<hr>
<p>Keep Calm and Code in Python!</p>
<p>-- Bob</p>


    <div class="comments">
        <div id="disqus_thread"></div>
            <script type="text/javascript">
                var disqus_shortname = 'http-pybit-es';
                var disqus_identifier = 'django-registration-app.html';
                var disqus_url = 'https://pybit.es/django-registration-app.html';
                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
            </script>
        <noscript>Please enable JavaScript to view the comments.</noscript>
    </div>
        
    </div>
        <!-- /Content --> 

        <!-- Footer -->
        <div class="footer gradient-2">
            <div class="container footer-container ">
                <div class="row">
                    <div class="col-xs-4 col-sm-3 col-md-3 col-lg-3">
                        <div class="footer-title">Sitemap</div>
                        <ul class="list-unstyled">
                            <li><a href="https://pybit.es/pages/community.html">Community</a></li>
                            <li><a href="https://pybit.eshttps://codechalleng.es/100days/">100 Days Of Code</a></li>
                            <li><a href="https://pybit.es/pages/search.html">Search</a></li>
                            <li><a href="https://pybit.es/pages/privacy-policy.html">Privacy Policy</a></li>
                            <li><a href="https://pybit.es/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">Atom Feed</a></li>
                            <li><a href="https://pybit.es/feeds/all.rss.xml" type="application/rss+xml" rel="alternate">RSS Feed</a></li>
                        </ul>
                    </div>
                    <div class="col-xs-4 col-sm-3 col-md-3 col-lg-3">
                    </div>
                    <div class="col-xs-4 col-sm-3 col-md-3 col-lg-3">
                        <div class="footer-title">Reach Out</div>
                        <ul class="list-unstyled">
                            <li><a href="mailto:info@pybit.es" target="_blank">Email</a></li>
                            <li><a href="https://twitter.com/pybites" target="_blank">Twitter</a></li>
                            <li><a href="https://facebook.com/pybites" target="_blank">Facebook</a></li>
                            <li><a href="https://github.com/pybites" target="_blank">Github</a></li>
                            <li><a href="https://github.com/PyBites-Open-Source" target="_blank">Open Source</a></li>
                            <li><a href="https://www.youtube.com/channel/UCBn-uKDGsRBfcB0lQeOB_gA" target="_blank">YouTube</a></li>
                        </ul>
                    </div> 
                    <div class="col-xs-12 col-sm-3 col-md-3 col-lg-3">
                        <p class="pull-right text-right">
                            <small><em>Proudly powered by <a href="http://docs.getpelican.com/" target="_blank">pelican</a></em></small><br/>
                            <small><em>Theme and code by <a href="https://github.com/molivier" target="_blank">molivier</a></em></small><br/>
                            <small>&copy; PyBites 2016+</small>
                        </p>
                    </div>
                </div>
            </div>
        </div>
        <!-- /Footer -->
    </body>
</html>